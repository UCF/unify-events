!function(t,e){"use strict";"undefined"!=typeof module&&module.exports?module.exports=e(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],function(t){return e(t)}):e(t.jQuery)}(this,function(t){"use strict";var e=function(e,a){this.$element=t(e),this.options=t.extend({},t.fn.typeahead.defaults,a),this.matcher=this.options.matcher||this.matcher,this.sorter=this.options.sorter||this.sorter,this.select=this.options.select||this.select,this.autoSelect="boolean"==typeof this.options.autoSelect?this.options.autoSelect:!0,this.highlighter=this.options.highlighter||this.highlighter,this.render=this.options.render||this.render,this.updater=this.options.updater||this.updater,this.displayText=this.options.displayText||this.displayText,this.source=this.options.source,this.delay=this.options.delay,this.$menu=t(this.options.menu),this.$appendTo=this.options.appendTo?t(this.options.appendTo):null,this.shown=!1,this.listen(),this.showHintOnFocus="boolean"==typeof this.options.showHintOnFocus?this.options.showHintOnFocus:!1,this.afterSelect=this.options.afterSelect,this.addItem=!1};e.prototype={constructor:e,select:function(){var t=this.$menu.find(".active").data("value");if(this.$element.data("active",t),this.autoSelect||t){var e=this.updater(t);this.$element.val(this.displayText(e)||e).change(),this.afterSelect(e)}return this.hide()},updater:function(t){return t},setSource:function(t){this.source=t},show:function(){var e,a=t.extend({},this.$element.position(),{height:this.$element[0].offsetHeight});return e="function"==typeof this.options.scrollHeight?this.options.scrollHeight.call():this.options.scrollHeight,(this.$appendTo?this.$menu.appendTo(this.$appendTo):this.$menu.insertAfter(this.$element)).css({top:a.top+a.height+e,left:a.left}).show(),this.shown=!0,this},hide:function(){return this.$menu.hide(),this.shown=!1,this},lookup:function(e){if(this.query="undefined"!=typeof e&&null!==e?e:this.$element.val()||"",this.query.length<this.options.minLength)return this.shown?this.hide():this;var a=t.proxy(function(){t.isFunction(this.source)?this.source(this.query,t.proxy(this.process,this)):this.source&&this.process(this.source)},this);clearTimeout(this.lookupWorker),this.lookupWorker=setTimeout(a,this.delay)},process:function(e){var a=this;return e=t.grep(e,function(t){return a.matcher(t)}),e=this.sorter(e),e.length||this.options.addItem?(e.length>0?this.$element.data("active",e[0]):this.$element.data("active",null),this.options.addItem&&e.push(this.options.addItem),"all"==this.options.items?this.render(e).show():this.render(e.slice(0,this.options.items)).show()):this.shown?this.hide():this},matcher:function(t){var e=this.displayText(t);return~e.toLowerCase().indexOf(this.query.toLowerCase())},sorter:function(t){for(var e,a=[],i=[],s=[];e=t.shift();){var n=this.displayText(e);n.toLowerCase().indexOf(this.query.toLowerCase())?~n.indexOf(this.query)?i.push(e):s.push(e):a.push(e)}return a.concat(i,s)},highlighter:function(e){var a,i,s,n,o,r=t("<div></div>"),l=this.query,h=e.toLowerCase().indexOf(l.toLowerCase());if(a=l.length,0===a)return r.text(e).html();for(;h>-1;)i=e.substr(0,h),s=e.substr(h,a),n=e.substr(h+a),o=t("<strong></strong>").text(s),r.append(document.createTextNode(i)).append(o),e=n,h=e.toLowerCase().indexOf(l.toLowerCase());return r.append(document.createTextNode(e)).html()},render:function(e){var a=this,i=this,s=!1;return e=t(e).map(function(e,n){var o=i.displayText(n);return e=t(a.options.item).data("value",n),e.find("a").html(a.highlighter(o)),o==i.$element.val()&&(e.addClass("active"),i.$element.data("active",n),s=!0),e[0]}),this.autoSelect&&!s&&(e.first().addClass("active"),this.$element.data("active",e.first().data("value"))),this.$menu.html(e),this},displayText:function(t){return t.name||t},next:function(e){var a=this.$menu.find(".active").removeClass("active"),i=a.next();i.length||(i=t(this.$menu.find("li")[0])),i.addClass("active")},prev:function(t){var e=this.$menu.find(".active").removeClass("active"),a=e.prev();a.length||(a=this.$menu.find("li").last()),a.addClass("active")},listen:function(){this.$element.on("focus",t.proxy(this.focus,this)).on("blur",t.proxy(this.blur,this)).on("keypress",t.proxy(this.keypress,this)).on("keyup",t.proxy(this.keyup,this)),this.eventSupported("keydown")&&this.$element.on("keydown",t.proxy(this.keydown,this)),this.$menu.on("click",t.proxy(this.click,this)).on("mouseenter","li",t.proxy(this.mouseenter,this)).on("mouseleave","li",t.proxy(this.mouseleave,this))},destroy:function(){this.$element.data("typeahead",null),this.$element.data("active",null),this.$element.off("focus").off("blur").off("keypress").off("keyup"),this.eventSupported("keydown")&&this.$element.off("keydown"),this.$menu.remove()},eventSupported:function(t){var e=t in this.$element;return e||(this.$element.setAttribute(t,"return;"),e="function"==typeof this.$element[t]),e},move:function(t){if(this.shown){switch(t.keyCode){case 9:case 13:case 27:t.preventDefault();break;case 38:if(t.shiftKey)return;t.preventDefault(),this.prev();break;case 40:if(t.shiftKey)return;t.preventDefault(),this.next()}t.stopPropagation()}},keydown:function(e){this.suppressKeyPressRepeat=~t.inArray(e.keyCode,[40,38,9,13,27]),this.shown||40!=e.keyCode?this.move(e):this.lookup()},keypress:function(t){this.suppressKeyPressRepeat||this.move(t)},keyup:function(t){switch(t.keyCode){case 40:case 38:case 16:case 17:case 18:break;case 9:case 13:if(!this.shown)return;this.select();break;case 27:if(!this.shown)return;this.hide();break;default:this.lookup()}t.stopPropagation(),t.preventDefault()},focus:function(t){this.focused||(this.focused=!0,this.options.showHintOnFocus&&this.lookup(""))},blur:function(t){this.focused=!1,!this.mousedover&&this.shown&&this.hide()},click:function(t){t.stopPropagation(),t.preventDefault(),this.select(),this.$element.focus()},mouseenter:function(e){this.mousedover=!0,this.$menu.find(".active").removeClass("active"),t(e.currentTarget).addClass("active")},mouseleave:function(t){this.mousedover=!1,!this.focused&&this.shown&&this.hide()}};var a=t.fn.typeahead;t.fn.typeahead=function(a){var i=arguments;return"string"==typeof a&&"getActive"==a?this.data("active"):this.each(function(){var s=t(this),n=s.data("typeahead"),o="object"==typeof a&&a;n||s.data("typeahead",n=new e(this,o)),"string"==typeof a&&(i.length>1?n[a].apply(n,Array.prototype.slice.call(i,1)):n[a]())})},t.fn.typeahead.defaults={source:[],items:8,menu:'<ul class="typeahead dropdown-menu" role="listbox"></ul>',item:'<li><a href="#" role="option"></a></li>',minLength:1,scrollHeight:0,autoSelect:!0,afterSelect:t.noop,addItem:!1,delay:0},t.fn.typeahead.Constructor=e,t.fn.typeahead.noConflict=function(){return t.fn.typeahead=a,this},t(document).on("focus.typeahead.data-api",'[data-provide="typeahead"]',function(e){var a=t(this);a.data("typeahead")||a.typeahead(a.data())})}),function(t,e){function a(){return new Date(Date.UTC.apply(Date,arguments))}function i(){var t=new Date;return a(t.getFullYear(),t.getMonth(),t.getDate())}function s(t,e){return t.getUTCFullYear()===e.getUTCFullYear()&&t.getUTCMonth()===e.getUTCMonth()&&t.getUTCDate()===e.getUTCDate()}function n(t){return function(){return this[t].apply(this,arguments)}}function o(e,a){function i(t,e){return e.toLowerCase()}var s,n=t(e).data(),o={},r=new RegExp("^"+a.toLowerCase()+"([A-Z])");a=new RegExp("^"+a.toLowerCase());for(var l in n)a.test(l)&&(s=l.replace(r,i),o[s]=n[l]);return o}function r(e){var a={};if(m[e]||(e=e.split("-")[0],m[e])){var i=m[e];return t.each(f,function(t,e){e in i&&(a[e]=i[e])}),a}}var l=function(){var e={get:function(t){return this.slice(t)[0]},contains:function(t){for(var e=t&&t.valueOf(),a=0,i=this.length;i>a;a++)if(this[a].valueOf()===e)return a;return-1},remove:function(t){this.splice(t,1)},replace:function(e){e&&(t.isArray(e)||(e=[e]),this.clear(),this.push.apply(this,e))},clear:function(){this.length=0},copy:function(){var t=new l;return t.replace(this),t}};return function(){var a=[];return a.push.apply(a,arguments),t.extend(a,e),a}}(),h=function(e,a){this._process_options(a),this.dates=new l,this.viewDate=this.o.defaultViewDate,this.focusDate=null,this.element=t(e),this.isInline=!1,this.isInput=this.element.is("input"),this.component=this.element.hasClass("date")?this.element.find(".add-on, .input-group-addon, .btn"):!1,this.hasInput=this.component&&this.element.find("input").length,this.component&&0===this.component.length&&(this.component=!1),this.picker=t(v.template),this._buildEvents(),this._attachEvents(),this.isInline?this.picker.addClass("datepicker-inline").appendTo(this.element):this.picker.addClass("datepicker-dropdown dropdown-menu"),this.o.rtl&&this.picker.addClass("datepicker-rtl"),this.viewMode=this.o.startView,this.o.calendarWeeks&&this.picker.find("tfoot .today, tfoot .clear").attr("colspan",function(t,e){return parseInt(e)+1}),this._allow_update=!1,this.setStartDate(this._o.startDate),this.setEndDate(this._o.endDate),this.setDaysOfWeekDisabled(this.o.daysOfWeekDisabled),this.setDatesDisabled(this.o.datesDisabled),this.fillDow(),this.fillMonths(),this._allow_update=!0,this.update(),this.showMode(),this.isInline&&this.show()};h.prototype={constructor:h,_process_options:function(s){this._o=t.extend({},this._o,s);var n=this.o=t.extend({},this._o),o=n.language;switch(m[o]||(o=o.split("-")[0],m[o]||(o=p.language)),n.language=o,n.startView){case 2:case"decade":n.startView=2;break;case 1:case"year":n.startView=1;break;default:n.startView=0}switch(n.minViewMode){case 1:case"months":n.minViewMode=1;break;case 2:case"years":n.minViewMode=2;break;default:n.minViewMode=0}n.startView=Math.max(n.startView,n.minViewMode),n.multidate!==!0&&(n.multidate=Number(n.multidate)||!1,n.multidate!==!1&&(n.multidate=Math.max(0,n.multidate))),n.multidateSeparator=String(n.multidateSeparator),n.weekStart%=7,n.weekEnd=(n.weekStart+6)%7;var r=v.parseFormat(n.format);if(n.startDate!==-(1/0)&&(n.startDate=n.startDate?n.startDate instanceof Date?this._local_to_utc(this._zero_time(n.startDate)):v.parseDate(n.startDate,r,n.language):-(1/0)),n.endDate!==1/0&&(n.endDate=n.endDate?n.endDate instanceof Date?this._local_to_utc(this._zero_time(n.endDate)):v.parseDate(n.endDate,r,n.language):1/0),n.daysOfWeekDisabled=n.daysOfWeekDisabled||[],t.isArray(n.daysOfWeekDisabled)||(n.daysOfWeekDisabled=n.daysOfWeekDisabled.split(/[,\s]*/)),n.daysOfWeekDisabled=t.map(n.daysOfWeekDisabled,function(t){return parseInt(t,10)}),n.datesDisabled=n.datesDisabled||[],!t.isArray(n.datesDisabled)){var l=[];l.push(v.parseDate(n.datesDisabled,r,n.language)),n.datesDisabled=l}n.datesDisabled=t.map(n.datesDisabled,function(t){return v.parseDate(t,r,n.language)});var h=String(n.orientation).toLowerCase().split(/\s+/g),d=n.orientation.toLowerCase();if(h=t.grep(h,function(t){return/^auto|left|right|top|bottom$/.test(t)}),n.orientation={x:"auto",y:"auto"},d&&"auto"!==d)if(1===h.length)switch(h[0]){case"top":case"bottom":n.orientation.y=h[0];break;case"left":case"right":n.orientation.x=h[0]}else d=t.grep(h,function(t){return/^left|right$/.test(t)}),n.orientation.x=d[0]||"auto",d=t.grep(h,function(t){return/^top|bottom$/.test(t)}),n.orientation.y=d[0]||"auto";else;if(n.defaultViewDate){var c=n.defaultViewDate.year||(new Date).getFullYear(),u=n.defaultViewDate.month||0,f=n.defaultViewDate.day||1;n.defaultViewDate=a(c,u,f)}else n.defaultViewDate=i();n.showOnFocus=n.showOnFocus!==e?n.showOnFocus:!0},_events:[],_secondaryEvents:[],_applyEvents:function(t){for(var a,i,s,n=0;n<t.length;n++)a=t[n][0],2===t[n].length?(i=e,s=t[n][1]):3===t[n].length&&(i=t[n][1],s=t[n][2]),a.on(s,i)},_unapplyEvents:function(t){for(var a,i,s,n=0;n<t.length;n++)a=t[n][0],2===t[n].length?(s=e,i=t[n][1]):3===t[n].length&&(s=t[n][1],i=t[n][2]),a.off(i,s)},_buildEvents:function(){var e={keyup:t.proxy(function(e){-1===t.inArray(e.keyCode,[27,37,39,38,40,32,13,9])&&this.update()},this),keydown:t.proxy(this.keydown,this)};this.o.showOnFocus===!0&&(e.focus=t.proxy(this.show,this)),this.isInput?this._events=[[this.element,e]]:this.component&&this.hasInput?this._events=[[this.element.find("input"),e],[this.component,{click:t.proxy(this.show,this)}]]:this.element.is("div")?this.isInline=!0:this._events=[[this.element,{click:t.proxy(this.show,this)}]],this._events.push([this.element,"*",{blur:t.proxy(function(t){this._focused_from=t.target},this)}],[this.element,{blur:t.proxy(function(t){this._focused_from=t.target},this)}]),this._secondaryEvents=[[this.picker,{click:t.proxy(this.click,this)}],[t(window),{resize:t.proxy(this.place,this)}],[t(document),{"mousedown touchstart":t.proxy(function(t){this.element.is(t.target)||this.element.find(t.target).length||this.picker.is(t.target)||this.picker.find(t.target).length||this.hide()},this)}]]},_attachEvents:function(){this._detachEvents(),this._applyEvents(this._events)},_detachEvents:function(){this._unapplyEvents(this._events)},_attachSecondaryEvents:function(){this._detachSecondaryEvents(),this._applyEvents(this._secondaryEvents)},_detachSecondaryEvents:function(){this._unapplyEvents(this._secondaryEvents)},_trigger:function(e,a){var i=a||this.dates.get(-1),s=this._utc_to_local(i);this.element.trigger({type:e,date:s,dates:t.map(this.dates,this._utc_to_local),format:t.proxy(function(t,e){0===arguments.length?(t=this.dates.length-1,e=this.o.format):"string"==typeof t&&(e=t,t=this.dates.length-1),e=e||this.o.format;var a=this.dates.get(t);return v.formatDate(a,e,this.o.language)},this)})},show:function(){return this.element.attr("readonly")&&this.o.enableOnReadonly===!1?void 0:(this.isInline||this.picker.appendTo(this.o.container),this.place(),this.picker.show(),this._attachSecondaryEvents(),this._trigger("show"),(window.navigator.msMaxTouchPoints||"ontouchstart"in document)&&this.o.disableTouchKeyboard&&t(this.element).blur(),this)},hide:function(){return this.isInline?this:this.picker.is(":visible")?(this.focusDate=null,this.picker.hide().detach(),this._detachSecondaryEvents(),this.viewMode=this.o.startView,this.showMode(),this.o.forceParse&&(this.isInput&&this.element.val()||this.hasInput&&this.element.find("input").val())&&this.setValue(),this._trigger("hide"),this):this},remove:function(){return this.hide(),this._detachEvents(),this._detachSecondaryEvents(),this.picker.remove(),delete this.element.data().datepicker,this.isInput||delete this.element.data().date,this},_utc_to_local:function(t){return t&&new Date(t.getTime()+6e4*t.getTimezoneOffset())},_local_to_utc:function(t){return t&&new Date(t.getTime()-6e4*t.getTimezoneOffset())},_zero_time:function(t){return t&&new Date(t.getFullYear(),t.getMonth(),t.getDate())},_zero_utc_time:function(t){return t&&new Date(Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()))},getDates:function(){return t.map(this.dates,this._utc_to_local)},getUTCDates:function(){return t.map(this.dates,function(t){return new Date(t)})},getDate:function(){return this._utc_to_local(this.getUTCDate())},getUTCDate:function(){var t=this.dates.get(-1);return"undefined"!=typeof t?new Date(t):null},clearDates:function(){var t;this.isInput?t=this.element:this.component&&(t=this.element.find("input")),t&&t.val("").change(),this.update(),this._trigger("changeDate"),this.o.autoclose&&this.hide()},setDates:function(){var e=t.isArray(arguments[0])?arguments[0]:arguments;return this.update.apply(this,e),this._trigger("changeDate"),this.setValue(),this},setUTCDates:function(){var e=t.isArray(arguments[0])?arguments[0]:arguments;return this.update.apply(this,t.map(e,this._utc_to_local)),this._trigger("changeDate"),this.setValue(),this},setDate:n("setDates"),setUTCDate:n("setUTCDates"),setValue:function(){var t=this.getFormattedDate();return this.isInput?this.element.val(t).change():this.component&&this.element.find("input").val(t).change(),this},getFormattedDate:function(a){a===e&&(a=this.o.format);var i=this.o.language;return t.map(this.dates,function(t){return v.formatDate(t,a,i)}).join(this.o.multidateSeparator)},setStartDate:function(t){return this._process_options({startDate:t}),this.update(),this.updateNavArrows(),this},setEndDate:function(t){return this._process_options({endDate:t}),this.update(),this.updateNavArrows(),this},setDaysOfWeekDisabled:function(t){return this._process_options({daysOfWeekDisabled:t}),this.update(),this.updateNavArrows(),this},setDatesDisabled:function(t){this._process_options({datesDisabled:t}),this.update(),this.updateNavArrows()},place:function(){if(this.isInline)return this;var e=this.picker.outerWidth(),a=this.picker.outerHeight(),i=10,s=t(this.o.container).width(),n=t(this.o.container).height(),o=t(this.o.container).scrollTop(),r=t(this.o.container).offset(),l=[];this.element.parents().each(function(){var e=t(this).css("z-index");"auto"!==e&&0!==e&&l.push(parseInt(e))});var h=Math.max.apply(Math,l)+10,d=this.component?this.component.parent().offset():this.element.offset(),c=this.component?this.component.outerHeight(!0):this.element.outerHeight(!1),u=this.component?this.component.outerWidth(!0):this.element.outerWidth(!1),p=d.left-r.left,f=d.top-r.top;this.picker.removeClass("datepicker-orient-top datepicker-orient-bottom datepicker-orient-right datepicker-orient-left"),"auto"!==this.o.orientation.x?(this.picker.addClass("datepicker-orient-"+this.o.orientation.x),"right"===this.o.orientation.x&&(p-=e-u)):d.left<0?(this.picker.addClass("datepicker-orient-left"),p-=d.left-i):p+e>s?(this.picker.addClass("datepicker-orient-right"),p=d.left+u-e):this.picker.addClass("datepicker-orient-left");var m,v,g=this.o.orientation.y;if("auto"===g&&(m=-o+f-a,v=o+n-(f+c+a),g=Math.max(m,v)===v?"top":"bottom"),this.picker.addClass("datepicker-orient-"+g),"top"===g?f+=c:f-=a+parseInt(this.picker.css("padding-top")),this.o.rtl){var y=s-(p+u);this.picker.css({top:f,right:y,zIndex:h})}else this.picker.css({top:f,left:p,zIndex:h});return this},_allow_update:!0,update:function(){if(!this._allow_update)return this;var e=this.dates.copy(),a=[],i=!1;return arguments.length?(t.each(arguments,t.proxy(function(t,e){e instanceof Date&&(e=this._local_to_utc(e)),a.push(e)},this)),i=!0):(a=this.isInput?this.element.val():this.element.data("date")||this.element.find("input").val(),a=a&&this.o.multidate?a.split(this.o.multidateSeparator):[a],delete this.element.data().date),a=t.map(a,t.proxy(function(t){return v.parseDate(t,this.o.format,this.o.language)},this)),a=t.grep(a,t.proxy(function(t){return t<this.o.startDate||t>this.o.endDate||!t},this),!0),this.dates.replace(a),this.dates.length?this.viewDate=new Date(this.dates.get(-1)):this.viewDate<this.o.startDate?this.viewDate=new Date(this.o.startDate):this.viewDate>this.o.endDate&&(this.viewDate=new Date(this.o.endDate)),i?this.setValue():a.length&&String(e)!==String(this.dates)&&this._trigger("changeDate"),!this.dates.length&&e.length&&this._trigger("clearDate"),this.fill(),this},fillDow:function(){var t=this.o.weekStart,e="<tr>";if(this.o.calendarWeeks){this.picker.find(".datepicker-days thead tr:first-child .datepicker-switch").attr("colspan",function(t,e){return parseInt(e)+1});var a='<th class="cw">&#160;</th>';e+=a}for(;t<this.o.weekStart+7;)e+='<th class="dow">'+m[this.o.language].daysMin[t++%7]+"</th>";e+="</tr>",this.picker.find(".datepicker-days thead").append(e)},fillMonths:function(){for(var t="",e=0;12>e;)t+='<span class="month">'+m[this.o.language].monthsShort[e++]+"</span>";this.picker.find(".datepicker-months td").html(t)},setRange:function(e){e&&e.length?this.range=t.map(e,function(t){return t.valueOf()}):delete this.range,this.fill()},getClassNames:function(e){var a=[],i=this.viewDate.getUTCFullYear(),n=this.viewDate.getUTCMonth(),o=new Date;return e.getUTCFullYear()<i||e.getUTCFullYear()===i&&e.getUTCMonth()<n?a.push("old"):(e.getUTCFullYear()>i||e.getUTCFullYear()===i&&e.getUTCMonth()>n)&&a.push("new"),this.focusDate&&e.valueOf()===this.focusDate.valueOf()&&a.push("focused"),this.o.todayHighlight&&e.getUTCFullYear()===o.getFullYear()&&e.getUTCMonth()===o.getMonth()&&e.getUTCDate()===o.getDate()&&a.push("today"),-1!==this.dates.contains(e)&&a.push("active"),(e.valueOf()<this.o.startDate||e.valueOf()>this.o.endDate||-1!==t.inArray(e.getUTCDay(),this.o.daysOfWeekDisabled))&&a.push("disabled"),this.o.datesDisabled.length>0&&t.grep(this.o.datesDisabled,function(t){return s(e,t)}).length>0&&a.push("disabled","disabled-date"),this.range&&(e>this.range[0]&&e<this.range[this.range.length-1]&&a.push("range"),-1!==t.inArray(e.valueOf(),this.range)&&a.push("selected")),a},fill:function(){var i,s=new Date(this.viewDate),n=s.getUTCFullYear(),o=s.getUTCMonth(),r=this.o.startDate!==-(1/0)?this.o.startDate.getUTCFullYear():-(1/0),l=this.o.startDate!==-(1/0)?this.o.startDate.getUTCMonth():-(1/0),h=this.o.endDate!==1/0?this.o.endDate.getUTCFullYear():1/0,d=this.o.endDate!==1/0?this.o.endDate.getUTCMonth():1/0,c=m[this.o.language].today||m.en.today||"",u=m[this.o.language].clear||m.en.clear||"";if(!isNaN(n)&&!isNaN(o)){this.picker.find(".datepicker-days thead .datepicker-switch").text(m[this.o.language].months[o]+" "+n),this.picker.find("tfoot .today").text(c).toggle(this.o.todayBtn!==!1),this.picker.find("tfoot .clear").text(u).toggle(this.o.clearBtn!==!1),this.updateNavArrows(),this.fillMonths();var p=a(n,o-1,28),f=v.getDaysInMonth(p.getUTCFullYear(),p.getUTCMonth());p.setUTCDate(f),p.setUTCDate(f-(p.getUTCDay()-this.o.weekStart+7)%7);var g=new Date(p);g.setUTCDate(g.getUTCDate()+42),g=g.valueOf();for(var y,w=[];p.valueOf()<g;){if(p.getUTCDay()===this.o.weekStart&&(w.push("<tr>"),this.o.calendarWeeks)){var D=new Date(+p+(this.o.weekStart-p.getUTCDay()-7)%7*864e5),k=new Date(Number(D)+(11-D.getUTCDay())%7*864e5),b=new Date(Number(b=a(k.getUTCFullYear(),0,1))+(11-b.getUTCDay())%7*864e5),T=(k-b)/864e5/7+1;w.push('<td class="cw">'+T+"</td>")}if(y=this.getClassNames(p),y.push("day"),this.o.beforeShowDay!==t.noop){var C=this.o.beforeShowDay(this._utc_to_local(p));C===e?C={}:"boolean"==typeof C?C={enabled:C}:"string"==typeof C&&(C={classes:C}),C.enabled===!1&&y.push("disabled"),C.classes&&(y=y.concat(C.classes.split(/\s+/))),C.tooltip&&(i=C.tooltip)}y=t.unique(y),w.push('<td class="'+y.join(" ")+'"'+(i?' title="'+i+'"':"")+">"+p.getUTCDate()+"</td>"),i=null,p.getUTCDay()===this.o.weekEnd&&w.push("</tr>"),p.setUTCDate(p.getUTCDate()+1)}this.picker.find(".datepicker-days tbody").empty().append(w.join(""));var _=this.picker.find(".datepicker-months").find("th:eq(1)").text(n).end().find("span").removeClass("active");if(t.each(this.dates,function(t,e){e.getUTCFullYear()===n&&_.eq(e.getUTCMonth()).addClass("active")}),(r>n||n>h)&&_.addClass("disabled"),n===r&&_.slice(0,l).addClass("disabled"),n===h&&_.slice(d+1).addClass("disabled"),this.o.beforeShowMonth!==t.noop){var F=this;t.each(_,function(e,a){if(!t(a).hasClass("disabled")){var i=new Date(n,e,1),s=F.o.beforeShowMonth(i);s===!1&&t(a).addClass("disabled")}})}w="",n=10*parseInt(n/10,10);var $=this.picker.find(".datepicker-years").find("th:eq(1)").text(n+"-"+(n+9)).end().find("td");n-=1;for(var M,U=t.map(this.dates,function(t){return t.getUTCFullYear()}),x=-1;11>x;x++)M=["year"],-1===x?M.push("old"):10===x&&M.push("new"),-1!==t.inArray(n,U)&&M.push("active"),(r>n||n>h)&&M.push("disabled"),w+='<span class="'+M.join(" ")+'">'+n+"</span>",n+=1;$.html(w)}},updateNavArrows:function(){if(this._allow_update){var t=new Date(this.viewDate),e=t.getUTCFullYear(),a=t.getUTCMonth();switch(this.viewMode){case 0:this.picker.find(".prev").css(this.o.startDate!==-(1/0)&&e<=this.o.startDate.getUTCFullYear()&&a<=this.o.startDate.getUTCMonth()?{visibility:"hidden"}:{visibility:"visible"}),this.picker.find(".next").css(this.o.endDate!==1/0&&e>=this.o.endDate.getUTCFullYear()&&a>=this.o.endDate.getUTCMonth()?{visibility:"hidden"}:{visibility:"visible"});break;case 1:case 2:this.picker.find(".prev").css(this.o.startDate!==-(1/0)&&e<=this.o.startDate.getUTCFullYear()?{visibility:"hidden"}:{visibility:"visible"}),this.picker.find(".next").css(this.o.endDate!==1/0&&e>=this.o.endDate.getUTCFullYear()?{visibility:"hidden"}:{visibility:"visible"})}}},click:function(e){e.preventDefault();var i,s,n,o=t(e.target).closest("span, td, th");if(1===o.length)switch(o[0].nodeName.toLowerCase()){case"th":switch(o[0].className){case"datepicker-switch":this.showMode(1);break;case"prev":case"next":var r=v.modes[this.viewMode].navStep*("prev"===o[0].className?-1:1);switch(this.viewMode){case 0:this.viewDate=this.moveMonth(this.viewDate,r),this._trigger("changeMonth",this.viewDate);break;case 1:case 2:this.viewDate=this.moveYear(this.viewDate,r),1===this.viewMode&&this._trigger("changeYear",this.viewDate)}this.fill();break;case"today":var l=new Date;l=a(l.getFullYear(),l.getMonth(),l.getDate(),0,0,0),this.showMode(-2);var h="linked"===this.o.todayBtn?null:"view";this._setDate(l,h);break;case"clear":this.clearDates()}break;case"span":o.hasClass("disabled")||(this.viewDate.setUTCDate(1),o.hasClass("month")?(n=1,s=o.parent().find("span").index(o),i=this.viewDate.getUTCFullYear(),this.viewDate.setUTCMonth(s),this._trigger("changeMonth",this.viewDate),1===this.o.minViewMode&&this._setDate(a(i,s,n))):(n=1,s=0,i=parseInt(o.text(),10)||0,this.viewDate.setUTCFullYear(i),this._trigger("changeYear",this.viewDate),2===this.o.minViewMode&&this._setDate(a(i,s,n))),this.showMode(-1),this.fill());break;case"td":o.hasClass("day")&&!o.hasClass("disabled")&&(n=parseInt(o.text(),10)||1,i=this.viewDate.getUTCFullYear(),s=this.viewDate.getUTCMonth(),o.hasClass("old")?0===s?(s=11,i-=1):s-=1:o.hasClass("new")&&(11===s?(s=0,i+=1):s+=1),this._setDate(a(i,s,n)))}this.picker.is(":visible")&&this._focused_from&&t(this._focused_from).focus(),delete this._focused_from},_toggle_multidate:function(t){var e=this.dates.contains(t);if(t||this.dates.clear(),-1!==e?(this.o.multidate===!0||this.o.multidate>1||this.o.toggleActive)&&this.dates.remove(e):this.o.multidate===!1?(this.dates.clear(),this.dates.push(t)):this.dates.push(t),"number"==typeof this.o.multidate)for(;this.dates.length>this.o.multidate;)this.dates.remove(0)},_setDate:function(t,e){e&&"date"!==e||this._toggle_multidate(t&&new Date(t)),e&&"view"!==e||(this.viewDate=t&&new Date(t)),this.fill(),this.setValue(),e&&"view"===e||this._trigger("changeDate");var a;this.isInput?a=this.element:this.component&&(a=this.element.find("input")),a&&a.change(),!this.o.autoclose||e&&"date"!==e||this.hide()},moveMonth:function(t,a){if(!t)return e;if(!a)return t;var i,s,n=new Date(t.valueOf()),o=n.getUTCDate(),r=n.getUTCMonth(),l=Math.abs(a);if(a=a>0?1:-1,1===l)s=-1===a?function(){return n.getUTCMonth()===r}:function(){return n.getUTCMonth()!==i},i=r+a,n.setUTCMonth(i),(0>i||i>11)&&(i=(i+12)%12);else{for(var h=0;l>h;h++)n=this.moveMonth(n,a);i=n.getUTCMonth(),n.setUTCDate(o),s=function(){return i!==n.getUTCMonth()}}for(;s();)n.setUTCDate(--o),n.setUTCMonth(i);return n},moveYear:function(t,e){return this.moveMonth(t,12*e)},dateWithinRange:function(t){return t>=this.o.startDate&&t<=this.o.endDate},keydown:function(t){if(!this.picker.is(":visible"))return void(27===t.keyCode&&this.show());var e,a,s,n=!1,o=this.focusDate||this.viewDate;switch(t.keyCode){case 27:this.focusDate?(this.focusDate=null,this.viewDate=this.dates.get(-1)||this.viewDate,this.fill()):this.hide(),t.preventDefault();break;case 37:case 39:if(!this.o.keyboardNavigation)break;e=37===t.keyCode?-1:1,t.ctrlKey?(a=this.moveYear(this.dates.get(-1)||i(),e),s=this.moveYear(o,e),this._trigger("changeYear",this.viewDate)):t.shiftKey?(a=this.moveMonth(this.dates.get(-1)||i(),e),s=this.moveMonth(o,e),this._trigger("changeMonth",this.viewDate)):(a=new Date(this.dates.get(-1)||i()),a.setUTCDate(a.getUTCDate()+e),s=new Date(o),s.setUTCDate(o.getUTCDate()+e)),this.dateWithinRange(s)&&(this.focusDate=this.viewDate=s,this.setValue(),this.fill(),t.preventDefault());break;case 38:case 40:if(!this.o.keyboardNavigation)break;e=38===t.keyCode?-1:1,t.ctrlKey?(a=this.moveYear(this.dates.get(-1)||i(),e),s=this.moveYear(o,e),this._trigger("changeYear",this.viewDate)):t.shiftKey?(a=this.moveMonth(this.dates.get(-1)||i(),e),s=this.moveMonth(o,e),this._trigger("changeMonth",this.viewDate)):(a=new Date(this.dates.get(-1)||i()),a.setUTCDate(a.getUTCDate()+7*e),s=new Date(o),s.setUTCDate(o.getUTCDate()+7*e)),this.dateWithinRange(s)&&(this.focusDate=this.viewDate=s,this.setValue(),this.fill(),t.preventDefault());break;case 32:break;case 13:o=this.focusDate||this.dates.get(-1)||this.viewDate,this.o.keyboardNavigation&&(this._toggle_multidate(o),n=!0),this.focusDate=null,this.viewDate=this.dates.get(-1)||this.viewDate,this.setValue(),this.fill(),this.picker.is(":visible")&&(t.preventDefault(),"function"==typeof t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,this.o.autoclose&&this.hide());break;case 9:this.focusDate=null,this.viewDate=this.dates.get(-1)||this.viewDate,this.fill(),this.hide()}if(n){this._trigger(this.dates.length?"changeDate":"clearDate");var r;this.isInput?r=this.element:this.component&&(r=this.element.find("input")),r&&r.change()}},showMode:function(t){t&&(this.viewMode=Math.max(this.o.minViewMode,Math.min(2,this.viewMode+t))),this.picker.children("div").hide().filter(".datepicker-"+v.modes[this.viewMode].clsName).css("display","block"),this.updateNavArrows()}};var d=function(e,a){this.element=t(e),this.inputs=t.map(a.inputs,function(t){return t.jquery?t[0]:t}),delete a.inputs,u.call(t(this.inputs),a).bind("changeDate",t.proxy(this.dateUpdated,this)),this.pickers=t.map(this.inputs,function(e){return t(e).data("datepicker")}),this.updateDates()};d.prototype={updateDates:function(){this.dates=t.map(this.pickers,function(t){return t.getUTCDate()}),this.updateRanges()},updateRanges:function(){var e=t.map(this.dates,function(t){return t.valueOf()});t.each(this.pickers,function(t,a){a.setRange(e)})},dateUpdated:function(e){if(!this.updating){this.updating=!0;var a=t(e.target).data("datepicker"),i=a.getUTCDate(),s=t.inArray(e.target,this.inputs),n=s-1,o=s+1,r=this.inputs.length;if(-1!==s){if(t.each(this.pickers,function(t,e){e.getUTCDate()||e.setUTCDate(i)}),i<this.dates[n])for(;n>=0&&i<this.dates[n];)this.pickers[n--].setUTCDate(i);else if(i>this.dates[o])for(;r>o&&i>this.dates[o];)this.pickers[o++].setUTCDate(i);this.updateDates(),delete this.updating}}},remove:function(){t.map(this.pickers,function(t){t.remove()}),delete this.element.data().datepicker}};var c=t.fn.datepicker,u=function(a){var i=Array.apply(null,arguments);i.shift();var s;return this.each(function(){var n=t(this),l=n.data("datepicker"),c="object"==typeof a&&a;if(!l){var u=o(this,"date"),f=t.extend({},p,u,c),m=r(f.language),v=t.extend({},p,m,u,c);if(n.hasClass("input-daterange")||v.inputs){var g={inputs:v.inputs||n.find("input").toArray()};n.data("datepicker",l=new d(this,t.extend(v,g)))}else n.data("datepicker",l=new h(this,v))}return"string"==typeof a&&"function"==typeof l[a]&&(s=l[a].apply(l,i),s!==e)?!1:void 0}),s!==e?s:this};t.fn.datepicker=u;var p=t.fn.datepicker.defaults={autoclose:!1,beforeShowDay:t.noop,beforeShowMonth:t.noop,calendarWeeks:!1,clearBtn:!1,toggleActive:!1,daysOfWeekDisabled:[],datesDisabled:[],endDate:1/0,forceParse:!0,format:"mm/dd/yyyy",keyboardNavigation:!0,language:"en",minViewMode:0,multidate:!1,multidateSeparator:",",orientation:"auto",rtl:!1,startDate:-(1/0),startView:0,todayBtn:!1,todayHighlight:!1,weekStart:0,disableTouchKeyboard:!1,enableOnReadonly:!0,container:"body"},f=t.fn.datepicker.locale_opts=["format","rtl","weekStart"];t.fn.datepicker.Constructor=h;var m=t.fn.datepicker.dates={en:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],today:"Today",clear:"Clear"}},v={modes:[{clsName:"days",navFnc:"Month",navStep:1},{clsName:"months",navFnc:"FullYear",navStep:1},{clsName:"years",navFnc:"FullYear",navStep:10
}],isLeapYear:function(t){return t%4===0&&t%100!==0||t%400===0},getDaysInMonth:function(t,e){return[31,v.isLeapYear(t)?29:28,31,30,31,30,31,31,30,31,30,31][e]},validParts:/dd?|DD?|mm?|MM?|yy(?:yy)?/g,nonpunctuation:/[^ -\/:-@\[\u3400-\u9fff-`{-~\t\n\r]+/g,parseFormat:function(t){var e=t.replace(this.validParts,"\x00").split("\x00"),a=t.match(this.validParts);if(!e||!e.length||!a||0===a.length)throw new Error("Invalid date format.");return{separators:e,parts:a}},parseDate:function(i,s,n){function o(){var t=this.slice(0,u[d].length),e=u[d].slice(0,t.length);return t.toLowerCase()===e.toLowerCase()}if(!i)return e;if(i instanceof Date)return i;"string"==typeof s&&(s=v.parseFormat(s));var r,l,d,c=/([\-+]\d+)([dmwy])/,u=i.match(/([\-+]\d+)([dmwy])/g);if(/^[\-+]\d+[dmwy]([\s,]+[\-+]\d+[dmwy])*$/.test(i)){for(i=new Date,d=0;d<u.length;d++)switch(r=c.exec(u[d]),l=parseInt(r[1]),r[2]){case"d":i.setUTCDate(i.getUTCDate()+l);break;case"m":i=h.prototype.moveMonth.call(h.prototype,i,l);break;case"w":i.setUTCDate(i.getUTCDate()+7*l);break;case"y":i=h.prototype.moveYear.call(h.prototype,i,l)}return a(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate(),0,0,0)}u=i&&i.match(this.nonpunctuation)||[],i=new Date;var p,f,g={},y=["yyyy","yy","M","MM","m","mm","d","dd"],w={yyyy:function(t,e){return t.setUTCFullYear(e)},yy:function(t,e){return t.setUTCFullYear(2e3+e)},m:function(t,e){if(isNaN(t))return t;for(e-=1;0>e;)e+=12;for(e%=12,t.setUTCMonth(e);t.getUTCMonth()!==e;)t.setUTCDate(t.getUTCDate()-1);return t},d:function(t,e){return t.setUTCDate(e)}};w.M=w.MM=w.mm=w.m,w.dd=w.d,i=a(i.getFullYear(),i.getMonth(),i.getDate(),0,0,0);var D=s.parts.slice();if(u.length!==D.length&&(D=t(D).filter(function(e,a){return-1!==t.inArray(a,y)}).toArray()),u.length===D.length){var k;for(d=0,k=D.length;k>d;d++){if(p=parseInt(u[d],10),r=D[d],isNaN(p))switch(r){case"MM":f=t(m[n].months).filter(o),p=t.inArray(f[0],m[n].months)+1;break;case"M":f=t(m[n].monthsShort).filter(o),p=t.inArray(f[0],m[n].monthsShort)+1}g[r]=p}var b,T;for(d=0;d<y.length;d++)T=y[d],T in g&&!isNaN(g[T])&&(b=new Date(i),w[T](b,g[T]),isNaN(b)||(i=b))}return i},formatDate:function(e,a,i){if(!e)return"";"string"==typeof a&&(a=v.parseFormat(a));var s={d:e.getUTCDate(),D:m[i].daysShort[e.getUTCDay()],DD:m[i].days[e.getUTCDay()],m:e.getUTCMonth()+1,M:m[i].monthsShort[e.getUTCMonth()],MM:m[i].months[e.getUTCMonth()],yy:e.getUTCFullYear().toString().substring(2),yyyy:e.getUTCFullYear()};s.dd=(s.d<10?"0":"")+s.d,s.mm=(s.m<10?"0":"")+s.m,e=[];for(var n=t.extend([],a.separators),o=0,r=a.parts.length;r>=o;o++)n.length&&e.push(n.shift()),e.push(s[a.parts[o]]);return e.join("")},headTemplate:'<thead><tr><th class="prev">&#171;</th><th colspan="5" class="datepicker-switch"></th><th class="next">&#187;</th></tr></thead>',contTemplate:'<tbody><tr><td colspan="7"></td></tr></tbody>',footTemplate:'<tfoot><tr><th colspan="7" class="today"></th></tr><tr><th colspan="7" class="clear"></th></tr></tfoot>'};v.template='<div class="datepicker"><div class="datepicker-days"><table class=" table-condensed">'+v.headTemplate+"<tbody></tbody>"+v.footTemplate+'</table></div><div class="datepicker-months"><table class="table-condensed">'+v.headTemplate+v.contTemplate+v.footTemplate+'</table></div><div class="datepicker-years"><table class="table-condensed">'+v.headTemplate+v.contTemplate+v.footTemplate+"</table></div></div>",t.fn.datepicker.DPGlobal=v,t.fn.datepicker.noConflict=function(){return t.fn.datepicker=c,this},t.fn.datepicker.version="1.4.0",t(document).on("focus.datepicker.data-api click.datepicker.data-api",'[data-provide="datepicker"]',function(e){var a=t(this);a.data("datepicker")||(e.preventDefault(),u.call(a,"show"))}),t(function(){u.call(t('[data-provide="datepicker-inline"]'))})}(window.jQuery);var bulkSelectAll=function(){$("#bulk-select-all").click(function(){var t=$(this),e=$(".field-bulk-select input");e.prop("checked",t.is(":checked"))})},bulkActionSubmit=function(){var t=$("#bulk-action_0, #bulk-action_1");t.removeAttr("onchange"),$("#bulk-action_0, #bulk-action_1").change(function(){var t=this.form,e=$(this),a=e.find("option:selected"),i=$('input:checkbox:checked[name="object_ids"]'),s=!1;if(a.attr("value")&&"empty"!==a.attr("value")&&i.length)if("delete"===a.val())if(i.each(function(){var t=$(this);return parseInt(t.attr("data-event-instance-count"))>1?(s=!0,!1):void 0}),s){var n=$("#bulk-event-delete-modal");n.find("#bulk-event-delete-btn").click(function(){t.submit()}),n.modal()}else t.submit();else t.submit()})},toggleEventListRecurrences=function(){$(".recurrences-toggle").click(function(t){t.preventDefault(),$(this).next(".recurrences").slideToggle()})},toggleModalMergeObject=function(){var t=$("#object-merge-modal");$(".category-merge, .tag-merge, .location-merge").click(function(e){e.preventDefault();var a=$(this).attr("data-object-title"),i=$(this).attr("data-object-pk"),s=$(this).attr("href"),n="";n=$(this).hasClass("category-merge")?"category":"tag",t.find("#new-object-select option").each(function(){$(this).text()===a&&$(this).val()===i?$(this).prop("disabled",!0):$(this).prop("disabled",!1)}),t.find("span.object-type").text(n).end().find("h2 span.alt").text(a).end().find(".modal-footer a.btn-primary").attr("href",s).end().modal("show")});var e=t.find(".modal-footer a.btn:first-child");e.click(function(){var t=$("#new-object-select").val(),a=e.attr("href");""!==t&&(a=a.replace(/merge\/[A-Za-z0-9]+$/,"merge/"+t),e.attr("href",a))})},calendarOwnershipModal=function(){if($("#calendar-reassign-ownership")){var t=$("#calendar-reassign-ownership"),e=t.find(".modal-footer a.btn:first-child");e.click(function(){var t=$("#new-owner-select").val(),a=e.attr("href");""!==t&&(a=a.replace(/user\/[A-Za-z0-9]+$/,"user/"+t),e.attr("href",a))})}},toggleModalUserDemote=function(){var t=$("#user-demote-modal");$(".demote-self").click(function(e){e.preventDefault();var a=$(this).attr("data-user-name"),i=$(this).attr("href");t.find("h2 span.alt").text(a).end().find(".modal-footer a.btn-danger").attr("href",i).end().modal("show")});var e=t.find(".modal-footer a.btn:first-child");e.click(function(){var t=$("#new-object-select").val(),a=e.attr("href");""!==t&&(a=a.replace(/merge\/[A-Za-z0-9]+$/,"merge/"+t),e.attr("href",a))})},fallbackDtpOnClick=function(t){var e=t.siblings("input");e.is(":focus")||e.focus()},initiateDatePickers=function(t){t.each(function(){var t=$(this);t.parent().hasClass("bootstrap-datepicker")===!1&&t.addClass("form-control").wrap('<div class="bootstrap-dtp bootstrap-datepicker" />').parent().append('<i class="fa fa-calendar" />');var e=t.parent().parent(),a=e.siblings().find("."+t.attr("class"));t.datepicker({format:"mm/dd/yyyy",autoclose:!0,todayHighlight:!0,startDate:EARLIEST_VALID_DATE,endDate:LATEST_VALID_DATE}).on("changeDate",function(t){a.length&&e.hasClass("start")?a.datepicker("setStartDate",t.date):a.length&&e.hasClass("end")&&a.datepicker("setEndDate",t.date)}),e.find("i").on("click",function(){fallbackDtpOnClick($(this))})}).removeClass("placeholder").placeholder()},initiateTimePickers=function(t){t.each(function(){var t=$(this);t.parent().hasClass("bootstrap-timepicker")===!1&&t.addClass("form-control").wrap('<div class="bootstrap-dtp bootstrap-timepicker" />').parent().append('<i class="fa fa-clock-o" />');var e=t.parent().parent();e.find("i").on("click",function(){fallbackDtpOnClick($(this))})}).timepicker({scrollDefaultNow:!0,timeFormat:"h:i A",step:15}).removeClass("placeholder").placeholder()},initiateWysiwyg=function(t){t.wysihtml5({"font-styles":!1,emphasis:!0,lists:!0,html:!1,link:!0,image:!1,color:!1,size:"md",events:{load:function(){$("ul.wysihtml5-toolbar").find('li a[data-wysihtml5-command="createLink"]').html('<i class="fa fa-link"></i>').end().find("li.dropdown a").attr("tabindex","-1").end().find("i.glyphicon-list").attr("class","fa fa-list-ul").end().find("i.glyphicon-th-list").attr("class","fa fa-list-ol").end().find('li a[data-wysihtml5-command="Outdent"]').remove().end().find('li a[data-wysihtml5-command="Indent"]').remove().end().find('li a[data-wysihtml5-command="bold"]').html('<i class="fa fa-bold"></i>').end().find('li a[data-wysihtml5-command="italic"]').html('<i class="fa fa-italic"></i>').end().find('li a[data-wysihtml5-command="underline"]').html('<i class="fa fa-underline"></i>'),$(document.activeElement).blur()}}})},initiateDisabledWysiwyg=function(t){t.wysihtml5({"font-styles":!1,emphasis:!1,lists:!1,html:!1,link:!1,image:!1,color:!1,events:{load:function(){$(document.activeElement).blur()}}})},initiateReReviewCopy=function(){$("#copy_title").click(function(t){t.preventDefault(),$("#"+$(this).attr("data-copy-to")).val($("#new_title").val())}),$("#copy_description").click(function(t){t.preventDefault(),$("#"+$(this).attr("data-copy-to")).data("wysihtml5").editor.setValue($("#new_description").val())})},selectFieldAutocomplete=function(t,e){this.autocompleteField=t,this.dataField=e,this.form=e.parents("form"),this.searchableTerms=[],this.mappedData={},this.selection=null,this.setupForm=function(){},this.onFormSubmission=function(){var t=this;t.form.on("submit",function(){return t.autocompleteField.is(":focus")?!1:void 0})},this.checkEmptyValues=function(){var t=this;t.autocompleteField.on("keydown",function(e){t.autocompleteField.val()||"keydown"!==e.type||8!==e.keyCode&&46!==e.keyCode||(t.autocompleteField.trigger("change"),t.dataField.is("select")&&(t.dataField.children("option:selected").removeAttr("selected"),t.dataField.children("option:selected").prop("selected",!1)),t.dataField.val(""))})},this.setSearchTerms=function(){var t=this;t.dataField.is("select")&&$.each(t.dataField.children("option:not([disabled])"),function(){var e=$(this),a=e.val(),i=e.text();$.trim(i).length<1&&(i=a+" (name n/a)"),t.mappedData[i]=a,t.searchableTerms.push(i)})},this.typeaheadSource=function(t,e){var a=this;return e(a.searchableTerms)},this.typeaheadMatcher=function(t,e){return-1!==t.toLowerCase().indexOf(e.trim().toLowerCase())?!0:void 0},this.typeaheadUpdater=function(t){var e=this;return e.selection=e.mappedData[t],e.dataField.val(e.selection),e.dataField.is("select")&&e.dataField.children('option[value="'+e.selection+'"]').attr("selected",!0).prop("selected",!0),t},this.init=function(){var t=this;t.setupForm(),t.onFormSubmission(),t.checkEmptyValues(),t.setSearchTerms(),t.autocompleteField.typeahead({items:10,minLength:2,source:function(e,a){t.typeaheadSource(e,a)},matcher:function(e){var a=this.query;return t.typeaheadMatcher(e,a)},updater:function(e){return e=t.typeaheadUpdater(e)}})}},userSearchTypeahead=function(){var t=$("#id_add_user"),e=$("#id_username_d"),a=$("#id_role"),i=e.parents("form"),s=i.find("button"),n=new selectFieldAutocomplete(t,e);n.roleField=a,n.addBtn=s,n.setupForm=function(){var t=this;t.dataField.hide(),t.autocompleteField.show(),$('label[for="'+t.dataField.attr("id")+'"]').attr("for",t.autocompleteField.attr("id"));var e=function(t){t.preventDefault()},a=function(){if(""!==t.autocompleteField.val()&&t.dataField.val()&&""!==t.roleField.val()&&t.autocompleteField.val()!==t.autocompleteField.attr("placeholder")){var a=t.dataField.children("option").selected||t.dataField.children('option[selected="selected"]');"undefined"!=typeof a&&a.length>0&&a.text()===t.autocompleteField.val()?t.addBtn.removeClass("disabled").unbind("click",e):t.addBtn.addClass("disabled").bind("click",e)}else t.addBtn.addClass("disabled").bind("click",e)};a(),$([t.autocompleteField,t.dataField,t.roleField]).each(function(){$(this).on("change",function(){a()})})},n.onFormSubmission=function(){var t=this;t.form.on("submit",function(){if(t.autocompleteField.is(":focus"))return!1;if(t.form.find("button").hasClass("disabled")===!1){var e=t.form.attr("action"),a=t.dataField.children("option:selected").val(),i=t.roleField.val();e=e.replace("/username/role","/"+a+"/"+i),t.form.attr("action",e)}})},n.init()},eventLocationsSearch=function(t){t.length>0&&t.each(function(){var t=$(this),e=t.attr("id")+"-autocomplete",a=$('<input type="text" id="'+e+'" class="form-control location-autocomplete search-query" autocomplete="off" placeholder="Type a location name..." />'),i=t.parent(".location-search").parent(".row"),s=i.find(".location-selected-title"),n=i.find(".location-selected-room"),o=i.find(".location-selected-url"),r=i.find(".location-new-form"),l=new selectFieldAutocomplete(a,t);l.addBtn=$('<a class="autocomplete-new-btn btn btn-success" href="#" alt="Create New Location"><i class="fa fa-plus"></i></a>'),l.removeBtn=$('<a class="location-selected-remove" href="#" alt="Remove Location" title="Remove Location">&times;</a>'),l.locationRow=i,l.locationTitleSpan=s,l.locationRoomSpan=n,l.locationUrlSpan=o,l.newLocationForm=r,l.createNewLocation=function(t){var e=this;e.removeLocation(),e.newLocationForm.show().children('input[name*="-new_location_title"]').val(t),e.removeBtn.show(),e.addBtn.hide(),e.autocompleteField.val("")},l.removeLocation=function(){var t=this;t.locationTitleSpan.text("").hide(),t.locationRoomSpan.text("").hide(),t.locationUrlSpan.text("").hide(),t.newLocationForm.hide().children("input").val(""),t.dataField.children('option[selected="selected"]').removeAttr("selected").prop("selected",!1),t.removeBtn.hide()},l.setupForm=function(){var t=this;t.locationRow.find("."+t.addBtn.attr("class")).remove(),t.locationRow.find("."+t.removeBtn.attr("class")).remove(),t.locationRow.find("#"+t.autocompleteField.attr("id")).remove(),t.dataField.hide(),t.autocompleteField.insertAfter(t.dataField).show(),$('label[for="'+t.dataField.attr("id")+'"]').attr("for",t.autocompleteField.attr("id")),t.addBtn.insertAfter(t.autocompleteField).hide(),t.removeBtn.insertBefore(t.locationTitleSpan),t.newLocationForm.children('input[name*="-new_location_title"]').val()||t.newLocationForm.hide(),""===t.dataField.val()&&""===$.trim(t.locationTitleSpan.text())&&t.removeBtn.hide(),t.removeBtn.on("click",function(e){e.preventDefault(),t.removeLocation()}),t.addBtn.on("click",function(e){e.preventDefault();var a=t.autocompleteField.val();t.createNewLocation(a)}),t.autocompleteField.on("keydown focus",function(e){var a=t.autocompleteField.siblings(".typeahead.dropdown-menu"),i=a.children("li").length>0&&a.is(":visible")?!0:!1;if(""!==t.autocompleteField.val())if(i||"keydown"!==e.type||13===e.keyCode||188===e.keyCode){if(!i&&"keydown"===e.type&&13===e.keyCode||"keydown"===e.type&&188===e.keyCode){var s=t.autocompleteField.val();return t.createNewLocation(s),t.addBtn.hide(),!1}}else t.addBtn.show();else t.addBtn.hide()}),t.dataField.parents(".cloneable").hasClass("clone")&&(t.dataField.get(0).selectedIndex=t.dataField.children('option[selected="selected"]').val())},l.typeaheadUpdater=function(t){var e=this;e.removeLocation(),e.selection=e.mappedData[t],e.dataField.val(e.selection).children('option[value="'+e.selection+'"]').attr("selected",!0).prop("selected",!0);var a=eventLocations[e.selection];return"None"!==a.title&&""!==a.title&&e.locationTitleSpan.text(a.title).show(),"None"!==a.room&&""!==a.room&&e.locationRoomSpan.text(a.room).show(),"None"!==a.url&&""!==a.url&&e.locationUrlSpan.html('<a href="'+a.url+'">'+a.url+"</a>").show(),e.removeBtn.show(),e.addBtn.hide(),""},l.init()})},eventTagging=function(){var t=$('<input type="text" class="form-control" id="id_event-tags-autocomplete" autocomplete="off" placeholder="Type a tag or phrase..." />'),e=$("#id_event-tags"),a=$('<a class="autocomplete-new-btn btn btn-success" href="#" alt="Create New Tag"><i class="fa fa-plus"></i></a>'),i=$("#event-tags-selected");if(e.length>0){var s=new selectFieldAutocomplete(t,e);s.addBtn=a,s.selectedTagsList=i,s.selectedTagsArray=[],s.createTag=function(t){var e=this,a=$('<a href="#" class="selected-remove" alt="Remove this tag" title="Remove this tag">&times;</a>');if(a.on("click",function(t){t.preventDefault(),e.removeTag($(this).parent("li"))}),!(t.length>0))return!1;var i=$('<li data-tag-name="'+t+'">'+t+"</li>");i.appendTo(e.selectedTagsList).prepend(a),e.addBtn.hide()},s.removeTag=function(t){var e=this;e.selectedTagsList.find(t).remove();var a=t.attr("data-tag-name");e.selectedTagsArray.splice($.inArray(a,e.selectedTagsArray),1)},s.getCleanItemVal=function(t){return $.trim(t.replace(/([^a-zA-Z0-9\s-!$#%&+|:?])/g,""))},s.setupForm=function(){var e=this;if(e.dataField.is(":visible")){var a="";if(e.dataField.val()?a=e.dataField.val():e.dataField.attr("value")&&(a=e.dataField.attr("value")),""!==a){var i=$.grep(a.replace(/(&quot;?)|\"/g,"").split(","),function(t){return""!==t});e.selectedTagsArray=e.selectedTagsArray.concat(i),e.selectedTagsList.children().length<1&&$.each(i,function(t,a){e.createTag(e.getCleanItemVal(a))})}e.dataField.hide(),e.autocompleteField.insertAfter(e.dataField).show(),$('label[for="'+e.dataField.attr("id")+'"]').attr("for",e.autocompleteField.attr("id")),e.addBtn.insertAfter(e.autocompleteField).hide();var s=e.dataField.siblings(".help-block");s.text('Type a word or phrase, then hit the "enter" key or type a comma to add it to your list of tags.')}e.addBtn.on("click",function(t){t.preventDefault();var a=e.getCleanItemVal(e.autocompleteField.val());a.length>0&&e.typeaheadUpdater(a)}),e.autocompleteField.on("keydown focus",function(a){var i=e.autocompleteField.siblings(".typeahead.dropdown-menu"),s=i.children("li").length>0&&i.is(":visible")?!0:!1;if(""!==e.autocompleteField.val())if(s||"keydown"!==a.type||13===a.keyCode||188===a.keyCode){if(!s&&"keydown"===a.type&&13===a.keyCode||"keydown"===a.type&&188===a.keyCode){var n=e.getCleanItemVal(t.val());return n.length>0&&e.typeaheadUpdater(n),e.addBtn.hide(),!1}}else e.addBtn.show();else e.addBtn.hide()})},s.onFormSubmission=function(){var t=this;t.form.on("submit",function(){if(t.autocompleteField.is(":focus"))return!1;""!==t.autocompleteField.val()&&t.autocompleteField.val()!==t.autocompleteField.attr("placeholder")&&t.selectedTagsArray.push(t.autocompleteField.val());var e=t.selectedTagsArray.toString()+",";t.dataField.val(e).attr("value",e)})},s.setSearchTerms=function(){var t=this;t.searchableTerms=eventTags,$.each(eventTags,function(e,a){t.mappedData[a]=a})},s.typeaheadUpdater=function(t){var e=this;return e.selection=e.mappedData[t],e.selectedTagsArray.push(t),e.autocompleteField.val(""),e.createTag(t),""},s.init()}},cloneableFieldsets=function(){if($(".cloneable").length>0){var t=$(".cloneable").parent(),e=t.children(":first"),a=t.parent().find(".cloner"),i=e.attr("data-form-prefix");a.html('<div>Add another event instance...</div><a class="btn btn-success" href="#" alt="Add another event instance" title="Add another event instance"><i class="fa fa-plus"></i></a>');var s=function(t,e,a){var i=new RegExp("("+e+"-\\d+-)"),s=e+"-"+a+"-";$(t).attr("for")&&$(t).attr("for",$(t).attr("for").replace(i,s)),t.id&&(t.id=t.id.replace(i,s)),t.name&&(t.name=t.name.replace(i,s))},n=function(e){1===$("#id_"+e+"-TOTAL_FORMS").val()||$(".cloneable").length<2?t.find(".remove-instance").addClass("hidden"):t.find(".remove-instance").removeClass("hidden")},o=function(t,e){var a=parseInt($("#id_"+e+"-TOTAL_FORMS").val(),10);return a>1&&($(t).parents(".cloneable").slideUp(300).find('input[id*="-DELETE"]').prop("checked",!0),setTimeout(function(){""===$(t).parents(".cloneable").find('input[id$="-id"]').val()&&$(t).parents(".cloneable").remove();var i=$(".cloneable");$("#id_"+e+"-TOTAL_FORMS").val(i.length);var o=0;for(a=i.length;a>o;o++)for(var r=$(i.get(o)).find("input, textarea, select, label"),l=0;l<r.length;l++)s(r.get(l),e,o);n(e)},300)),!1},r=function(t,a){var i=parseInt($("#id_"+a+"-TOTAL_FORMS").val(),10);if(i<$("#id_"+a+"-MAX_NUM_FORMS").val()){var r=e.clone(!1).get(0);$(r).removeAttr("id").addClass("clone").hide().insertAfter(".cloneable:last").slideDown(300).find("input, textarea, select, label").each(function(){s(this,a,i);var t=$(this);t.is("select")?t.attr("id").indexOf("interval")>=0&&t.find("option:first").attr("selected","selected"):t.val("")}),$(r).find(".remove-instance").click(function(){return o(this,a)}),initiateDatePickers($(r).find(".field-date")),initiateTimePickers($(r).find(".field-time")),eventLocationsSearch($(r).find(".location-dropdown")),$("#id_"+a+"-TOTAL_FORMS").val(i+1),n(a)}else window.alert("Sorry, you can only create a maximum of twelve time/locations.");return!1};n(i),a.click(function(t){return t.preventDefault(),r(this,i)}),$(".remove-instance").click(function(t){return t.preventDefault(),o(this,i)})}},eventContactInfo=function(){var t=$("#add-user-contact-info");"undefined"!=typeof usersFullName&&"undefined"!=typeof usersEmail?t.on("change",function(){var e=$("#id_event-contact_name"),a=$("#id_event-contact_email");usersFullName&&usersEmail&&(t.is(":checked")?(e.val(usersFullName),a.val(usersEmail)):e.val()===usersFullName&&a.val()===usersEmail&&(e.val(""),a.val("")))}):t.parent().hide()};$(document).ready(function(){bulkSelectAll(),bulkActionSubmit(),toggleEventListRecurrences(),toggleModalMergeObject(),calendarOwnershipModal(),toggleModalUserDemote(),initiateDatePickers($(".field-date")),initiateTimePickers($(".field-time")),initiateWysiwyg($('textarea.wysiwyg:not(".disabled-wysiwyg")')),initiateDisabledWysiwyg($("textarea.wysiwyg.disabled-wysiwyg")),initiateReReviewCopy(),userSearchTypeahead(),eventLocationsSearch($("select.location-dropdown")),eventTagging(),cloneableFieldsets(),eventContactInfo()});