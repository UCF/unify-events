var bulkSelectAll=function(){$("#bulk-select-all").click(function(){var e=$(this),t=$(".field-bulk-select input");t.prop("checked",e.is(":checked"))})},bulkActionSubmit=function(){var e=$("#bulk-action_0, #bulk-action_1");e.removeAttr("onchange"),$("#bulk-action_0, #bulk-action_1").change(function(){var e=this.form;actionInput=$(this),actionInputValue=actionInput.find("option:selected"),eventsSelected=$('input:checkbox:checked[name="object_ids"]'),recurringEvents=!1,actionInputValue.attr("value")&&eventsSelected.length&&("delete"==actionInputValue.val()?(eventsSelected.each(function(e,t){var a=$(this);return parseInt(a.attr("data-event-instance-count"))>1?(recurringEvents=!0,!1):void 0}),recurringEvents?(bulkEventDeleteModal=$("#bulk-event-delete-modal"),bulkEventDeleteModal.find("#bulk-event-delete-btn").click(function(){e.submit()}),bulkEventDeleteModal.modal()):e.submit()):e.submit())})},autoOpenTagByAnchor=function(){var e=window.location.hash.substring(1),t=$('.nav-tabs li a[href="#'+e+'"]').parent("li"),a=$("#"+e);null!==e&&a.length>0&&a.hasClass("tab-pane")&&($(".nav-tabs li.active, .tab-pane.active").removeClass("active"),t.addClass("active"),a.addClass("active"))},toggleModalModifyObject=function(){$(".object-modify").click(function(e){e.preventDefault();var t=$(this),a=t.attr("href"),i=$("#object-modify-modal");i?$.ajax({url:a,timeout:600}).done(function(e){var t=$("<div />");t.html(e);var n="",o="",l="";t.find(".object-modify-form").length>0?(n=t.find("h1").html(),o=t.find(".modal-body-content").html(),l=t.find(".modal-footer-content").html()):(n="Error",o="<p>You do not have access to this content.</p>",l='<a class="btn" data-dismiss="modal" href="#">Close</a>'),i.find("h2").html(n).end().find("form").attr("action",a).end().find(".modal-body").html(o).end().find(".modal-footer").html(l).end().modal("show")}).fail(function(){window.location=a}):window.location=a})},toggleModalMergeObject=function(){var e=$("#object-merge-modal");$(".category-merge, .tag-merge, .location-merge").click(function(t){t.preventDefault();var a=$(this).attr("data-object-title"),i=$(this).attr("href"),n="";n=$(this).hasClass("category-merge")?"category":"tag",e.find("#new-object-select option").each(function(){$(this).text()==a?$(this).prop("disabled",!0):$(this).prop("disabled",!1)}),e.find("span.object-type").text(n).end().find("h2 span.alt").text(a).end().find(".modal-footer a.btn-primary").attr("href",i).end().modal("show")});var t=e.find(".modal-footer a.btn:first-child");t.click(function(){var e=$("#new-object-select").val(),a=t.attr("href");""!==e&&(a=a.replace(/merge\/[A-Za-z0-9]+$/,"merge/"+e),t.attr("href",a))})},calendarSliders=function(){$("body").on("click",".calendar-slider ul.pager li a",function(e){e.preventDefault();var t=$(this).parents(".calendar-slider");$.get($(this).attr("data-ajax-link"),function(e){t.replaceWith(e)})})},inputTypeSupport=function(e){var t=document.createElement("input");return t.setAttribute("type",e),t.type==e?!0:!1},initiateDatePickers=function(e){e.each(function(){var e=$(this);e.parent().hasClass("bootstrap-datepicker")===!1&&e.addClass("form-control").wrap('<div class="bootstrap-dtp bootstrap-datepicker" />').parent().append('<i class="fa fa-calendar" />');var t=e.parent().parent(),a=t.siblings().find("."+e.attr("class"));e.datepicker({format:"mm/dd/yyyy",autoclose:!0,todayHighlight:!0}).on("changeDate",function(e){a.length&&t.hasClass("start")?a.datepicker("setStartDate",e.date):a.length&&t.hasClass("end")&&a.datepicker("setEndDate",e.date)})})},initiateTimePickers=function(e){e.each(function(){$(this).parent().hasClass("bootstrap-timepicker")===!1&&$(this).addClass("form-control").wrap('<div class="bootstrap-dtp bootstrap-timepicker" />').parent().append('<i class="fa fa-clock-o" />')}).timepicker({scrollDefaultNow:!0,timeFormat:"h:i A",step:15})},initiateWysiwyg=function(e){e.wysihtml5({"font-styles":!1,emphasis:!0,lists:!0,html:!1,link:!0,image:!1,color:!1,size:"md",events:{load:function(){$("ul.wysihtml5-toolbar").find('li a[data-wysihtml5-command="createLink"]').html('<i class="fa fa-link"></i>').end().find("li.dropdown a").attr("tabindex","-1").end().find("i.glyphicon-list").attr("class","fa fa-list-ul").end().find("i.glyphicon-th-list").attr("class","fa fa-list-ol").end().find("i.glyphicon-indent-left").attr("class","fa fa-indent").end().find("i.glyphicon-indent-right").attr("class","fa fa-outdent").end().find('li a[data-wysihtml5-command="bold"]').html('<i class="fa fa-bold"></i>').end().find('li a[data-wysihtml5-command="italic"]').html('<i class="fa fa-italic"></i>').end().find('li a[data-wysihtml5-command="underline"]').html('<i class="fa fa-underline"></i>')}}})},initiateDisabledWysiwyg=function(e){e.wysihtml5({"font-styles":!1,emphasis:!1,lists:!1,html:!1,link:!1,image:!1,color:!1})},initiateReReviewCopy=function(){$("#copy_title").click(function(e){e.preventDefault(),$("#"+$(this).attr("data-copy-to")).val($("#new_title").val())}),$("#copy_description").click(function(e){e.preventDefault(),$("#"+$(this).attr("data-copy-to")).data("wysihtml5").editor.setValue($("#new_description").val())})},selectFieldAutocomplete=function(e,t){this.autocompleteField=e,this.dataField=t,this.form=t.parents("form"),this.searchableTerms=[],this.mappedData={},this.selection=null,this.setupForm=function(){},this.onFormSubmission=function(){var e=this;e.form.on("submit",function(t){return e.autocompleteField.is(":focus")?!1:void 0})},this.checkEmptyValues=function(){var e=this;e.autocompleteField.on("keyup",function(t){e.autocompleteField.val()||"keyup"!=t.type||8!=t.keyCode&&46!=t.keyCode||(e.autocompleteField.trigger("change"),e.dataField.is("select")&&(e.dataField.children("option:selected").removeAttr("selected"),e.dataField.children("option:selected").prop("selected",!1)),e.dataField.val(""))})},this.setSearchTerms=function(){var e=this;e.dataField.is("select")&&$.each(e.dataField.children("option:not([disabled])"),function(){var t=$(this),a=t.val(),i=t.text();$.trim(i).length<1&&(i=a+" (name n/a)"),e.mappedData[i]=a,e.searchableTerms.push(i)})},this.typeaheadSource=function(e,t){var a=this;return t(a.searchableTerms)},this.typeaheadMatcher=function(e,t){return-1!=e.toLowerCase().indexOf(t.trim().toLowerCase())?!0:void 0},this.typeaheadUpdater=function(e){var t=this;return t.selection=t.mappedData[e],t.dataField.val(t.selection),t.dataField.is("select")&&t.dataField.children('option[value="'+t.selection+'"]').attr("selected",!0).prop("selected",!0),e},this.init=function(){var e=this;e.setupForm(),e.onFormSubmission(),e.checkEmptyValues(),e.setSearchTerms(),e.autocompleteField.typeahead({items:10,minLength:2,source:function(t,a){e.typeaheadSource(t,a)},matcher:function(t){var a=this.query;return e.typeaheadMatcher(t,a)},updater:function(t){var t=e.typeaheadUpdater(t);return t}})}},userSearchTypeahead=function(){var e=$("#id_add_user"),t=$("#id_username_d"),a=$("#id_role"),i=t.parents("form"),n=i.find("button"),o=new selectFieldAutocomplete(e,t);o.roleField=a,o.addBtn=n,o.setupForm=function(){var e=this;e.dataField.hide(),e.autocompleteField.show(),$('label[for="'+e.dataField.attr("id")+'"]').attr("for",e.autocompleteField.attr("id"));var t=function(e){e.preventDefault()},a=function(){""!==e.autocompleteField.val()&&e.dataField.val()&&""!==e.roleField.val()?e.addBtn.removeClass("disabled").unbind("click",t):e.addBtn.addClass("disabled").bind("click",t)};a(),$([e.autocompleteField,e.dataField,e.roleField]).each(function(){$(this).on("change",function(){a()})})},o.onFormSubmission=function(){var e=this;e.form.on("submit",function(t){if(e.autocompleteField.is(":focus"))return!1;if(e.form.find("button").hasClass("disabled")===!1){var a=e.form.attr("action"),i=e.dataField.children("option:selected").val(),n=e.roleField.val();a=a.replace("/username/role","/"+i+"/"+n),e.form.attr("action",a)}})},o.init()},cloneableFieldsets=function(){if($(".cloneable").length>0){var e=$(".cloneable").parent(),t=e.children(":first"),a=e.parent().find(".cloner"),i=t.attr("data-form-prefix");a.html('<div>Add another event instance...</div><a class="btn btn-success" href="#" alt="Add another event instance" title="Add another event instance"><i class="fa fa-plus"></i></a>');var n=function(e,t,a){var i=new RegExp("("+t+"-\\d+-)"),n=t+"-"+a+"-";$(e).attr("for")&&$(e).attr("for",$(e).attr("for").replace(i,n)),e.id&&(e.id=e.id.replace(i,n)),e.name&&(e.name=e.name.replace(i,n))},o=function(t){1==$("#id_"+t+"-TOTAL_FORMS").val()||$(".cloneable").length<2?e.find(".remove-instance").addClass("hidden"):e.find(".remove-instance").removeClass("hidden")},l=function(e,t){var a=parseInt($("#id_"+t+"-TOTAL_FORMS").val(),10);return a>1&&($(e).parents(".cloneable").slideUp(300).find('input[id*="-DELETE"]').prop("checked",!0),setTimeout(function(){""==$(e).parents(".cloneable").find('input[id$="-id"]').val()&&$(e).parents(".cloneable").remove();var i=$(".cloneable");$("#id_"+t+"-TOTAL_FORMS").val(i.length);var l=0;for(a=i.length;a>l;l++)$(i.get(l)).find("input, textarea, select, label").each(function(){n(this,t,l)});o(t)},300)),!1},r=function(e,a){var i=parseInt($("#id_"+a+"-TOTAL_FORMS").val(),10);if(i<$("#id_"+a+"-MAX_NUM_FORMS").val()){var r=t.clone(!1).get(0);$(r).removeAttr("id").addClass("clone").hide().insertAfter(".cloneable:last").slideDown(300).find("input, textarea, select, label").each(function(){n(this,a,i);var e=$(this);e.is("select")?e.attr("id").indexOf("interval")>=0&&e.find("option:first").attr("selected","selected"):e.val("")}),$(r).find(".remove-instance").click(function(){return l(this,a)}),initiateDatePickers($(r).find(".field-date")),initiateTimePickers($(r).find(".field-time")),eventLocationsSearch($(r).find(".location-dropdown")),$("#id_"+a+"-TOTAL_FORMS").val(i+1),o(a)}else alert("Sorry, you can only create a maximum of twelve time/locations.");return!1};o(i),a.click(function(e){return e.preventDefault(),r(this,i)}),$(".remove-instance").click(function(e){return e.preventDefault(),l(this,i)})}},calendarOwnershipModal=function(){if($("#calendar-reassign-ownership")){var e=$("#calendar-reassign-ownership"),t=e.find(".modal-footer a.btn:first-child");t.click(function(){var e=$("#new-owner-select").val(),a=t.attr("href");""!==e&&(a=a.replace(/user\/[A-Za-z0-9]+$/,"user/"+e),t.attr("href",a))})}},calendarSubscribeModal=function(){if($("#calendar-subscribe-modal")){var e=$("#calendar-subscribe-modal"),t=e.find(".modal-footer a.btn:first-child");$(".calendar-subscribe").click(function(t){t.preventDefault(),e.modal("show")}),t.click(function(){var e=$("#new-subscription-select").val(),a=t.attr("href");""!==e&&(a=a.replace(/calendar\/[A-Za-z0-9-]+\/subscribe/,"calendar/"+e+"/subscribe"),t.attr("href",a))})}},toggleEventListRecurrences=function(){$(".recurrences-toggle").click(function(e){e.preventDefault(),$(this).next(".recurrences").slideToggle()})},eventLocationsSearch=function(e){e.length>0&&e.each(function(){var e=$(this),t=e.attr("id")+"-autocomplete",a=$('<input type="text" id="'+t+'" class="form-control location-autocomplete search-query" autocomplete="off" placeholder="Type a location name..." />'),i=e.parent(".location-search").parent(".row"),n=i.find(".location-selected-title"),o=i.find(".location-selected-room"),l=i.find(".location-selected-url"),r=i.find(".location-new-form"),c=new selectFieldAutocomplete(a,e);c.addBtn=$('<a class="autocomplete-new-btn btn btn-success" href="#" alt="Create New Location"><i class="fa fa-plus"></i></a>'),c.removeBtn=$('<a class="location-selected-remove" href="#" alt="Remove Location" title="Remove Location">&times;</a>'),c.locationRow=i,c.locationTitleSpan=n,c.locationRoomSpan=o,c.locationUrlSpan=l,c.newLocationForm=r,c.createNewLocation=function(e){var t=this;t.removeLocation(),t.newLocationForm.show().children('input[name*="-new_location_title"]').val(e),t.removeBtn.show(),t.addBtn.hide(),t.autocompleteField.val("")},c.removeLocation=function(){var e=this;e.locationTitleSpan.text("").hide(),e.locationRoomSpan.text("").hide(),e.locationUrlSpan.text("").hide(),e.newLocationForm.hide().children("input").val(""),e.dataField.children('option[selected="selected"]').removeAttr("selected").prop("selected",!1),e.removeBtn.hide()},c.setupForm=function(){var e=this;e.locationRow.find("."+e.addBtn.attr("class")).remove(),e.locationRow.find("."+e.removeBtn.attr("class")).remove(),e.locationRow.find("#"+e.autocompleteField.attr("id")).remove(),e.dataField.hide(),e.autocompleteField.insertAfter(e.dataField).show(),$('label[for="'+e.dataField.attr("id")+'"]').attr("for",e.autocompleteField.attr("id")),e.addBtn.insertAfter(e.autocompleteField).hide(),e.removeBtn.insertBefore(e.locationTitleSpan),e.newLocationForm.children('input[name*="-new_location_title"]').val()||e.newLocationForm.hide(),""==e.dataField.val()&&""==$.trim(e.locationTitleSpan.text())&&e.removeBtn.hide(),e.removeBtn.on("click",function(t){t.preventDefault(),e.removeLocation()}),e.addBtn.on("click",function(t){t.preventDefault();var a=e.autocompleteField.val();e.createNewLocation(a)}),e.autocompleteField.on("keyup focus",function(t){var a=e.autocompleteField.siblings(".typeahead.dropdown-menu"),i=a.children("li").length>0&&a.is(":visible")?!0:!1;if(""!==e.autocompleteField.val())if(i||"keyup"!=t.type||13===t.keyCode||188===t.keyCode){if(!i&&"keyup"==t.type&&13==t.keyCode||"keyup"==t.type&&188==t.keyCode){var n=e.autocompleteField.val();e.createNewLocation(n),e.addBtn.hide()}}else e.addBtn.show();else e.addBtn.hide()}),e.dataField.parents(".cloneable").hasClass("clone")&&(e.dataField.get(0).selectedIndex=e.dataField.children('option[selected="selected"]').val())},c.typeaheadUpdater=function(e){var t=this;t.removeLocation(),t.selection=t.mappedData[e],t.dataField.val(t.selection).children('option[value="'+t.selection+'"]').attr("selected",!0).prop("selected",!0);var a=eventLocations[t.selection];return t.locationTitleSpan.text(a.title).show(),t.locationRoomSpan.text(a.room).show(),t.locationUrlSpan.html('<a href="'+a.url+'">'+a.url+"</a>").show(),t.removeBtn.show(),t.addBtn.hide(),""},c.init()})};eventTagging=function(){var e=$('<input type="text" class="form-control" id="id_event-tags-autocomplete" autocomplete="off" placeholder="Type a tag or phrase..." />'),t=$("#id_event-tags"),a=$('<a class="autocomplete-new-btn btn btn-success" href="#" alt="Create New Tag"><i class="fa fa-plus"></i></a>'),i=$("#event-tags-selected"),n=t.parents("form");if(t.length>0){var o=new selectFieldAutocomplete(e,t);o.addBtn=a,o.selectedTagsList=i,o.selectedTagsArray=[],o.createTag=function(e){var t=this,a=$('<a href="#" class="selected-remove" alt="Remove this tag" title="Remove this tag">&times;</a>');a.on("click",function(e){e.preventDefault(),t.removeTag($(this).parent("li"))});var i=$('<li data-tag-name="'+$.trim(e)+'">'+$.trim(e)+"</li>");i.appendTo(t.selectedTagsList).prepend(a),t.addBtn.hide()},o.removeTag=function(e){var t=this;t.selectedTagsList.find(e).remove();var a=e.attr("data-tag-name");t.selectedTagsArray.splice($.inArray(a,t.selectedTagsArray),1)},o.getCleanItemVal=function(e){return e.replace(/([^a-zA-Z0-9\s-!$#%&+|:?])/g,"")},o.setupForm=function(){var t=this;if(t.dataField.is(":visible")){var a="";if(t.dataField.val()?a=t.dataField.val():t.dataField.attr("value")&&(a=t.dataField.attr("value")),""!==a){var i=a.replace(/\"/g,"").split(",").filter(Boolean);t.selectedTagsArray=t.selectedTagsArray.concat(i),t.selectedTagsList.children().length<1&&$.each(i,function(e,a){t.createTag(a)})}t.dataField.hide(),t.autocompleteField.insertAfter(t.dataField).show(),$('label[for="'+t.dataField.attr("id")+'"]').attr("for",t.autocompleteField.attr("id")),t.addBtn.insertAfter(t.autocompleteField).hide();var n=t.dataField.siblings(".help-text");n.text('Type a word or phrase, then hit the "enter" key or type a comma to add it to your list of tags.')}t.addBtn.on("click",function(e){e.preventDefault();var a=t.getCleanItemVal(t.autocompleteField.val());t.typeaheadUpdater(a)}),t.autocompleteField.on("keyup focus",function(a){var i=t.autocompleteField.siblings(".typeahead.dropdown-menu"),n=i.children("li").length>0&&i.is(":visible")?!0:!1;if(""!==t.autocompleteField.val())if(n||"keyup"!=a.type||13===a.keyCode||188===a.keyCode){if(!n&&"keyup"==a.type&&13==a.keyCode||"keyup"==a.type&&188==a.keyCode){var o=t.getCleanItemVal(e.val());t.typeaheadUpdater(o),t.addBtn.hide()}}else t.addBtn.show();else t.addBtn.hide()})},o.onFormSubmission=function(){var e=this;e.form.on("submit",function(t){if(e.autocompleteField.is(":focus"))return!1;""!==e.autocompleteField.val()&&e.selectedTagsArray.push(e.autocompleteField.val());var a=o.selectedTagsArray.toString();o.dataField.val(a).attr("value",a)})},o.setSearchTerms=function(){var e=this;e.searchableTerms=eventTags,$.each(eventTags,function(t,a){e.mappedData[a]=a})},o.typeaheadUpdater=function(e){var t=this;return t.selection=t.mappedData[e],t.selectedTagsArray.push(e),t.autocompleteField.val(""),t.createTag(e),""},o.init()}};var toggleModalUserDemote=function(){var e=$("#user-demote-modal");$(".demote-self").click(function(t){t.preventDefault();var a=$(this).attr("data-user-name"),i=$(this).attr("href");e.find("h2 span.alt").text(a).end().find(".modal-footer a.btn-danger").attr("href",i).end().modal("show")});var t=e.find(".modal-footer a.btn:first-child");t.click(function(){var e=$("#new-object-select").val(),a=t.attr("href");""!==e&&(a=a.replace(/merge\/[A-Za-z0-9]+$/,"merge/"+e),t.attr("href",a))})},updateMonthviewDropdown=function(){var e=$("#month-toggle"),t=e.find("#id_year"),a=e.find("#id_month");a.change(function(){var t=e.attr("action"),a="/"+$(this).val()+"/",i=t.slice(t.length-4,t.length),n=t.replace(i,a);e.attr("action",n)}),t.change(function(){var t=e.attr("action"),a="/"+$(this).val()+"/",i=t.slice(t.length-9,t.length-3),n=t.replace(i,a);e.attr("action",n)})},eventContactInfo=function(){$("#add-user-contact-info").click(function(e){var t=$(this);e.preventDefault(),usersFullName&&usersEmail&&($("#id_event-contact_name").val(usersFullName),$("#id_event-contact_email").val(usersEmail))})};$(document).ready(function(){bulkSelectAll(),bulkActionSubmit(),autoOpenTagByAnchor(),toggleModalModifyObject(),toggleModalMergeObject(),toggleModalUserDemote(),calendarSliders(),initiateDatePickers($(".field-date")),initiateTimePickers($(".field-time")),initiateWysiwyg($('textarea.wysiwyg:not(".disabled-wysiwyg")')),initiateDisabledWysiwyg($("textarea.wysiwyg.disabled-wysiwyg")),initiateReReviewCopy(),userSearchTypeahead(),cloneableFieldsets(),calendarOwnershipModal(),calendarSubscribeModal(),toggleEventListRecurrences(),eventLocationsSearch($("select.location-dropdown")),eventTagging(),updateMonthviewDropdown(),eventContactInfo()});