{% load humanize %}

{% if event_instances %}
    {% regroup event_instances by start.date|date:"l, F j, Y" as dates %}
    {% for day in dates %}
        <h3>{{ day.grouper }}</h3>
        <ul class="event-list">
        {% for event_instance in day.list %}
            <li class="event {{ event_instance.event.category.slug }}">
                <a class="event-content url" href="{% url 'event' pk=event_instance.pk slug=event_instance.event.slug %}">
                    <!-- if img -->
                    <!--<img src="" alt="image" title="image" />-->
                    <!-- endif -->
                    <h4>
                        <span class="summary">{% if event_instance.event.canceled %}CANCELED: {% endif %}{{ event_instance.title }}</span>
                        {% if event_instance.is_recurring %}
                        <i class="icon-repeat"></i>
                        <span class="recurring">(Recurring Event)</span>
                        {% endif %}
                    </h4>
                    <span class="location">{{ event_instance.location }}</span>
                    <span class="description">
                        {{ event_instance.event.description|striptags|truncatewords:160 }}
                    </span>
                    <time class="dtstart" datetime="{{ event_instance.start|date:"cZ" }}">
                        {% if event_instance.start.time and event_instance.end.time %}
                            {{ event_instance.start|date:"f a" }}
                        {% elif event_instance.start.time|date:"H:i" == "00:00" and event_instance.end|date:"H:i" == "23:59" %}
                            All Day
                        {% elif event_instance.start.time|date:"H:i" == "00:00" and event_instance.end|date:"H:i" != "23:59" %}
                            until {{ event_instance.end|date:"f a" }}
                        {% else %}
                            All Day
                        {% endif %}
                        <span class="value-title" title="{{ event_instance.start|date:"cZ" }}"></span>
                    </time>
                </a>
                <span class="category {{ event_instance.event.category.slug }}">{{ event_instance.event.category.title }}</span>
            </li>
        {% endfor %}
        </ul>
    {% endfor %}
{% else %}
<p>No events found.</p>
{% endif %}
