{% extends 'events/manager/base.html' %}
{% load widgets %}

{% block content_title_icon %}
<i class="icon-tag" id="page-title-icon"></i>
{% endblock %}

{% block content_title %}
    <h1>Categories</h1>
{% endblock %}

{% block content_subheader %}{% endblock %}


{% block content_body %}
<div class="row">
    <div class="span9 page-content">
        {% if categories %}
        <a class="btn btn-primary page-top-action" href="{% url 'category-create' %}">
            <i class="icon-plus"></i> Create New Category
        </a>
        
        <table class="table table-striped table-hover manager-item-table">
            <thead>
                <tr>
                    <th class="category-title">Category</th>
                    <th class="category-events"><abbr title="Number of events with this category. Includes copied events and events that are pending and posted on the main calendar.">Event Count</abbr></th>
                    <th class="category-color">Color</th>
                    <th class="category-actions">Actions</th>
                </tr>
            </thead>
            <tbody>
            {% for category in categories %}
                <tr>
                    <td class="category-title">
                        <a href="{% url 'category-update' pk=category.id %}">{{ category.title }}</a>
                    </td>
                    <td class="category-events">
                        {{ category.events.count }}
                    </td>
                    <td class="category-color">
                        <span class="category-label {{ category.slug }}">{{ category.color }}</span>
                    </td>
                    <td class="category-actions">
                        
                        <div class="btn-group">
                            <a class="btn btn-mini dropdown-toggle" data-toggle="dropdown">
                                Select
                                <span class="caret"></span>
                            </a>
                            <ul class="dropdown-menu">
                                <li role="presentation">
                                    <a href="{% url 'category-update' pk=category.id %}">
                                        <i class="icon-pencil"></i>
                                        Edit Category
                                    </a>
                                </li>
                                {% if category.events.count > 0 %}
                                <li role="presentation">
                                    <a class="category-merge" href="{% url 'category-merge' category_from_id=category.id category_to_id=1 %}" data-object-title="{{ category.title }}">
                                        <i class="icon-resize-small"></i>
                                        Merge Category
                                    </a>
                                </li>
                                {% else %}
                                <li role="presentation">
                                    <a class="object-modify" href="{% url 'category-delete' pk=category.id %}">
                                        <i class="icon-trash"></i>
                                        Delete Category
                                    </a>
                                </li>
                                {% endif %}
                                <li class="divider"></li>
                                <li role="presentation">
                                    <a href="{% url 'category' category=category.slug %}">
                                        <i class="icon-circle-arrow-right"></i>
                                        Live View
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
        
        {% pager paginator=paginator current_page=request.GET.page %}
        
        {% else %}
            <div class="well well-empty">
                No categories found. Want to <a href="{% url 'category-create' %}">create one?</a>
            </div>
        {% endif %}
        
        <!-- Modal for Object Merge -->
        <div class="modal hide fade" id="object-merge-modal">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h2>Merge Category: <span class="alt"></span></h2>
            </div>
            <div class="modal-body">
                <p>
                    You are about to merge this category with another existing category. Merging this category
                    will assign any events that are currently assigned with this category to the category that
                    you select below.
                </p>
                <p>
                    Note: <em>The category you're merging will be <strong>deleted</strong> once you merge it.</em>
                    There is no undo!
                </p>
                <select id="new-object-select">
                    <option value="">Select an Existing Category</option>
                    {% for category in categories %}
                    <option value="{{ category.id }}">{{ category.title }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="modal-footer">
                <a href="#" class="btn btn-primary">Merge Category</a>
                <a href="#" data-dismiss="modal" class="btn">Cancel</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}