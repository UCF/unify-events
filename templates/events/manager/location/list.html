{% extends 'events/manager/base.html' %}
{% load widgets %}

{% block page_header %}
    {% spaceless %}
    {{block.super}} | Locations
    {% endspaceless %}
{% endblock %}

{% block content_title_icon %}
<i class="icon-map-marker" id="page-title-icon"></i>
{% endblock %}

{% block content_title %}
    <h1>Locations</h1>
{% endblock %}

{% block content_subheader %}{% endblock %}

{% block content_tabs %}
    <div class="row">
        <div class="span12">
            <ul class="nav nav-tabs">
                <li class="{{ state|yesno:',,active' }}">
                    <a href="{% url 'location-state' %}">All</a>
                </li>
                <li class="{% if state == 'review' %} active{% endif %}">
                    <a href="{% url 'location-state' state='review' %}">Review ({{ review_count }})</a>
                </li>
                <li class="{% if state == 'approved' %} active{% endif %}">
                    <a href="{% url 'location-state' state='approved' %}">Approved</a>
                </li>
            </ul>
        </div>
    </div>
{% endblock %}

{% block content_body %}
    <div class="row">
        <div class="span9 page-content">
            <a class="btn btn-primary page-top-action" href="{% url 'location-create' %}">
                <i class="icon-plus"></i> Create New Location
            </a>

            {% if locations %}
                <form action="{% url 'location-bulk-action' %}" class="form-horizontal bulk-action-form" method="post">
                    {% csrf_token %}
                    <div class="control-group">
                        <label for="bulk-action_0" class="control-label">Bulk Action:</label>
                        <div class="controls">
                            <select id="bulk-action_0" name="bulk-action_0" onchange="this.form.submit()">
                                <option>Select Action...</option>
                                <option value="approve">Approve</option>
                                <option value="review">Move to Review</option>
                                <option value="delete">Delete</option>
                            </select>
                        </div>
                    </div>
                    <table class="table table-striped table-hover manager-item-table">
                        <thead>
                            <tr>
                                <th class="field-bulk-select">
                                    <label class="label-hidden" for="bulk-select-all">Select All</label>
                                    <input type="checkbox" id="bulk-select-all" name="bulk-select-all" value="" />
                                </th>
                                <th class="location-title">Location Name</th>
                                <th class="location-room">Room</th>
                                <th class="location-url">URL</th>
                                <th class="location-status">Status</th>
                                <th class="location-actions">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                        {% for location in locations %}
                            <tr>
                                <td class="field-bulk-select">
                                    <label class="label-hidden" for="bulk-select">Bulk Action Select</label>
                                    <input type="checkbox" name="location_ids" value="{{ location.id }}" />
                                </td>
                                <td class="location-title">
                                    <a href="{% url 'location-update' pk=location.id %}">{{ location.title }}</a>
                                </td>
                                <td class="location-room">
                                    {{ location.room }}
                                </td>
                                <td class="location-url">
                                    <a href="{{ location.url }}" target="_blank">{{ location.url }}</a>
                                </td>
                                <td class="location-status">
                                    {% if location.reviewed %}
                                    Approved
                                    {% else %}
                                    Needs Review
                                    {% endif %}
                                </td>
                                <td class="location-actions">
                                    <div class="btn-group">
                                        <a class="btn btn-mini dropdown-toggle" data-toggle="dropdown">
                                            Select
                                            <span class="caret"></span>
                                        </a>
                                        <ul class="dropdown-menu">
                                            <li role="presentation">
                                                <a href="{% url 'location-update' pk=location.id %}">
                                                    <i class="icon-pencil"></i>
                                                    Edit Location
                                                </a>
                                            </li>
                                            {% if location.event_instances.count > 0 %}
                                            <li role="presentation">
                                                <a class="location-merge" href="{% url 'location-merge' location_from_id=location.id location_to_id=1 %}" data-object-title="{{ location.title }}">
                                                    <i class="icon-resize-small"></i>
                                                    Merge Location
                                                </a>
                                            </li>
                                            {% else %}
                                            <li role="presentation">
                                                <a class="object-modify" href="{% url 'location-delete' pk=location.id %}">
                                                    <i class="icon-trash"></i>
                                                    Delete Location
                                                </a>
                                            </li>
                                            {% endif %}
                                        </ul>
                                    </div>
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                    <div class="control-group">
                        <label for="bulk-action_1" class="control-label">Bulk Action:</label>
                        <div class="controls">
                            <select id="bulk-action_1" name="bulk-action_1" onchange="this.form.submit()">
                                <option>Select Action...</option>
                                <option value="approve">Approve</option>
                                <option value="review">Move to Review</option>
                                <option value="delete">Delete</option>
                            </select>
                        </div>
                    </div>
                </form>
            {% else %}
                <div class="well well-empty">
                    No locations found. Want to <a href="{% url 'location-create' %}">create one?</a>
                </div>
            {% endif %}
                {% pager paginator=paginator current_page=request.GET.page %}

                <!-- Modal for Object Merge -->
                <div class="modal hide fade" id="object-merge-modal">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h2>Merge Location: <span class="alt"></span></h2>
                    </div>
                    <div class="modal-body">
                        <p>
                            You are about to merge this location with another existing location. Merging this location
                            will assign any events that are currently assigned with this location to the location that
                            you select below.
                        </p>
                        <p>
                            Note: <em>The location you're merging will be <strong>deleted</strong> once you merge it.</em>
                            There is no undo!
                        </p>
                        <select id="new-object-select">
                            <option value="">Select an Existing Location</option>
                            {% for location in location_list %}
                            <option value="{{ location.id }}">{{ location.title }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="modal-footer">
                        <a href="#" class="btn btn-primary">Merge Location</a>
                        <a href="#" data-dismiss="modal" class="btn">Cancel</a>
                    </div>
                </div>
            </div>
        </div>
{% endblock %}
