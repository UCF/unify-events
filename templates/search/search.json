{% load core_tags %}

[
{% if query %}
    {% with results=page_obj.object_list %}
        {% if results %}

        {% comment %}
        Prioritize Main Calendar events. Assume that Main Calendar events
        will always be copied from somewhere else.

        Events use the first instance's search-list-item.html esi template.
        See esi/eventinstance/search-list-item.html for info.
        {% endcomment %}

            {% block results_list %}

            {% for result in results %}
                {% if result.model_name == 'event' %}
                    {% with item=result.object.get_main_event|default:result.object %}
                    {% include 'search/search-result.json' %}
                    {% endwith %}
                {% else %}
                    {% with item=result.object %}
                    {% include 'search/search-result.json' %}
                    {% endwith %}
                {% endif %}
                {% if not forloop.last %},{% endif %}
            {% endfor %}

            {% endblock %}

        {% endif %}
    {% endwith %}
{% endif %}
]
