<h1>Unify Events</h1>

<h2>Installation and Setup</h2>

<ol>
<li>Install Elasticsearch on your server (tested with v1.1.0) (http://www.elasticsearch.org/overview/elkdownloads/).  Requires at least Java 6.

<ul>
<li>via Homebrew: <code>brew install elasticsearch</code></li>
<li>via apt/yum: http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/setup-repositories.html</li>
</ul>
</li>
<li><p>Start Elasticsearch</p>

<ul>
<li>Unix: <code>bin/elasticsearch</code></li>
<li>Windows: <code>bin/elasticsearch.bat</code></li>
<li>See Linux service docs:

<ul>
<li>http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/setup.html</li>
<li>http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/setup-service.html</li>
</ul>
</li>
</ul>
</li>
<li><p>Install Open-LDAP development headers (debian: openldap-dev, rhel: openldap-devel)</p></li>
<li>Install Virtualenv for Python</li>
<li>via pip: <code>[sudo] pip install virtualenv</code></li>
<li><p>Create virtual environment and <code>cd</code> to it</p>

<pre><code> virtualenv ENV
 cd ENV
</code></pre></li>
<li>Clone repo to a subdirectory (ex. <code>git clone REPO_URL src</code>)</li>
<li><p>Activate virtual environment</p>

<pre><code> source bin/activate
</code></pre></li>
<li><p><code>cd</code> to new src directory and install requirements</p>

<pre><code> cd src
 pip install -r requirements.txt
</code></pre></li>
<li>Set up local settings using the local_settings.templ.py file</li>
<li>Set up apache/python.wsgi using apache/python.templ.wsgi</li>
<li>If necessary, configure VirtualHosts using apache/vhost.conf template</li>
<li><p>Sync the database. Create a new admin user when prompted. This user should have a unique (non-NID based) username.</p>

<pre><code>python manage.py syncdb
</code></pre></li>
<li><p>If you don&rsquo;t intend on importing any existing calendar data, create a Main Calendar. Otherwise, skip this step</p>

<pre><code>python manage.py shell
&gt;&gt;&gt; from events.models import Calendar
&gt;&gt;&gt; c = Calendar(title='Events at UCF')
&gt;&gt;&gt; c.save()
&gt;&gt;&gt; exit()
</code></pre></li>
<li><p>Rebuild the search index</p>

<pre><code>python manage.py rebuild_index
</code></pre></li>
<li><p>Collect static files</p>

<pre><code>python manage.py collectstatic -cl
</code></pre></li>
</ol>


<h2>Importing Data</h2>

<h3>UNL Events Import</h3>

<p>Note that this importer should only be run on a fresh database, immediately after running <code>python manage.py syncdb</code> or <code>python manage.py flush</code>.</p>

<ol>
<li>cd to the new virtual environment src folder</li>
<li><p>Activate virtual environment</p>

<pre><code> source ../bin/activate
</code></pre></li>
<li>Add old events database information to settings_local.py under DATABASES name &lsquo;unlevents&rsquo;</li>
<li><p>Run import command</p>

<pre><code> python manage.py import-unl-events
</code></pre></li>
<li><p>Rebuild the search index</p>

<pre><code> python manage.py rebuild_index
</code></pre></li>
<li>Ban cache and restart app as necessary</li>
</ol>


<h3>Locations Import</h3>

<ol>
<li>cd to the new virtual environment src folder</li>
<li><p>Activate virtual environment</p>

<pre><code> source ../bin/activate
</code></pre></li>
<li>Make sure that MAPS_DOMAIN and LOCATION_DATA_URL are set in settings_local.py</li>
<li><p>Run import command</p>

<pre><code> python manage.py import-locations
</code></pre></li>
<li><p>Rebuild the search index</p>

<pre><code> python manage.py rebuild_index
</code></pre></li>
<li>Ban cache and restart app as necessary</li>
</ol>


<h2>Code Contribution</h2>

<p>Never commit directly to master. Create a branch or fork and work on the new feature. Once it is complete it will be merged back to the master branch.</p>

<p>If you use a branch to develop a feature, make sure to delete the old branch once it has been merged to master.</p>

<h2>Development</h2>

<h3>Sass</h3>

<h4>Codekit Setup</h4>

<p>This project is configured to compile .scss assets and javascript files (located in <code>static_files/assets/</code>) using Codekit 2.x. Before modifying any style-related files, create a new project with this repo in Codekit (see Codekit docs: http://incident57.com/codekit/help.html)</p>

<p>After creating the new project, any modifications to files in <code>static_files/assets/</code> will automatically compile and minify to their respective <code>static_files/static/</code> locations.</p>

<h4>Bootstrap</h4>

<p>This project uses the official Sass port of Twitter Bootstrap (https://github.com/twbs/bootstrap-sass) for base styling of templates. <strong>Do not modify the files in this directory</strong>&ndash;override variables as necessary in <code>static_files/assets/scss/style.scss</code>.</p>

<p>The current version of Bootstrap is v3.2.0.</p>

<p>To upgrade Bootstrap, download the latest tagged release and replace the <code>static_files/static/vendor/bootstrap/</code> directory contents in this repo with the downloaded <code>assets/</code> directory contents (do not copy the Bootstrap root directory.)  Make sure to compile <code>static_files/assets/sass/style.scss</code> AND <code>static_files/static/vendor/bootstrap/javascripts/bootstrap.js</code> after!</p>

<h4>Font Awesome</h4>

<p>Version 4.0.3 of Font Awesome (http://fontawesome.io/) is used as a replacement for Bootstrap&rsquo;s Glyphicon icon library. <strong>Do not modify the files in this directory</strong>&ndash;override variables as necessary in <code>static_files/assets/scss/style.scss</code>.</p>

<p>Note that these icons do not overwrite the Glyphicon library; both are available to use, but Font Awesome fonts are preferred. See the Font Awesome docs for usage.</p>

<p>To upgrade, download the latest tagged release and replace the <code>static_files/static/vendor/fonts/font-awesome-4.x.x/</code> directory in this repo with the downloaded root directory.  Make sure to compile <code>static_files/assets/sass/style.scss</code> after!</p>

<h4>Theme Sass Files</h4>

<p>All of the raw custom styles for this project are contained in separate Sass files in <code>static_files/assets/sass/</code>. When modifying stylesheets in this project, only modify the files in this directory; <strong>do NOT modify any files in <code>static_files/css/</code></strong>! These Sass files will compile and overwrite <code>static_files/css/style.css</code>.</p>

<p>Partial Sass files are generally separated out by function, and must be compiled in a specific order. Keep in mind the following guidelines when modifying or adding styles:</p>

<ol>
<li><code>_utilities.scss</code><br/>
Where generic &ldquo;helper&rdquo; classes are defined.</li>
<li><code>_type.scss</code><br/>
Where generic paragraph, heading, link, list, etc. styles are defined. These can override Bootstrap-related classes.</li>
<li><code>_components.scss</code><br/>
Where generic Bootstrap component overrides (buttons, modals, panels, dropdowns, etc.) are defined.</li>
<li><code>_forms.scss</code><br/>
Where generic form-related styles are defined. These can override Bootstrap-related classes.</li>
<li><code>_calendar-small.scss</code><br/>
Styles specific to the small calendar sidebar widget, generated by the <code>{% calendar_widget %}</code> template tag. These styles do not modify the publicly-available Events Widget styles; these are managed separately in <code>/static_files/events-widget/</code>.</li>
<li><code>_calendar-large.scss</code><br/>
Styles specific to the full-size calendar (used in the frontend Calendar Month View), generated by the <code>{% calendar_widget %}</code> template tag.</li>
<li><code>_layout.scss</code><br/>
Styles related to base page structure; i.e. elements you would find in templates named <code>base.html</code> (header, navigation, sidebar, footer). View-specific styles should not be added here.</li>
<li><code>_views-frontend.scss</code><br/>
Frontend, view-specific styles. Make sure to label each view with specific comments, and group similar views together (i.e. a set of single Calendar view styles should go directly above or below already-defined Calendar view styles.)</li>
<li><code>_views-backend.scss</code><br/>
Backend, view-specific styles. Make sure to label each view with specific comments, and group similar views together (i.e. a set of single Calendar view styles should go directly above or below already-defined Calendar view styles.)</li>
</ol>

